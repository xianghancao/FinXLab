
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction &#8212; FinX Lab</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-examples.css?v=e236af4b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.bundle.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-shadow.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-punk.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-noir.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-light.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-borderless.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/micromodal.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/js/hoverxref.js"></script>
    <script src="../_static/js/tooltipster.bundle.min.js"></script>
    <script src="../_static/js/micromodal.min.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Risk/Financial_Risk_Forecasting_in_Python';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../Home/home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/me.jpg" class="logo__image only-light" alt="FinX Lab - Home"/>
    <script>document.write(`<img src="../_static/me.jpg" class="logo__image only-dark" alt="FinX Lab - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../Home/home.html">
                    FinX Lab
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../AboutMe/%E7%9B%AE%E5%BD%95.html">About Me</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../AboutMe/Events/article.html">Events</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../NLP/%E7%9B%AE%E5%BD%95.html">NLP</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../NLP/241128-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/article.html">使用 DistilBERT 进行情感分析：基于预训练模型的实战</a></li>
<li class="toctree-l2"><a class="reference internal" href="../NLP/241130-%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%9F%A2%E9%87%8F%E5%8C%96%E4%B8%8EKeras%E4%B8%AD%E7%9A%84Tokenizer%E4%BD%BF%E7%94%A8/article.html">文本数据矢量化与Keras中的Tokenizer使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../NLP/241224-Word-metric%20method%20VS%20Semantic%20measure/article.html">Word-metric methods VS Semantic Models</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../FinancialEconomics/%E7%9B%AE%E5%BD%95.html">Financial Economics</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../FinancialEconomics/240410-KPPS%20H-Step-Ahead%20Forecast%20Error%20Variance%20Decomposition/article.html">KPPS H-Step-Ahead Forecast Error Variance Decomposition(FEVD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FinancialEconomics/240620-KPPS%20H%E6%AD%A5%E9%A2%84%E6%B5%8B%E8%AF%AF%E5%B7%AE%E6%96%B9%E5%B7%AE%E5%88%86%E8%A7%A3%E7%9A%84Python%E5%AE%9E%E7%8E%B0/article.html">KPPS H步预测误差方差分解的Python实现</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FinancialEconomics/240717-%E5%87%A0%E7%A7%8D%E6%B3%A2%E5%8A%A8%E7%8E%87%E7%9A%84%E8%AE%A1%E7%AE%97/article.html">几种波动率的计算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FinancialEconomics/230501-DY%20method/article.html">Diebold&amp;Yilmaz method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FinancialEconomics/230501-DCC-GARCH%E7%9A%84R%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0/article.html">DCC-GARCH的R语言实现</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Networks/%E7%9B%AE%E5%BD%95.html">Networks</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Networks/240718-%E7%BD%91%E7%BB%9C%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%A7%E5%9B%BE%E7%BB%98%E5%88%B6/article.html">网络的相关性图绘制</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Networks/240721-%E5%9F%BA%E4%BA%8EiGraph%E7%9A%84%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%92%8C%E7%BB%98%E5%9B%BE/article.html">基于iGraph的网络分析和绘图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Networks/240723-%E5%A6%82%E4%BD%95%E7%BB%98%E5%88%B6%E5%9C%B0%E7%90%86%E5%9B%BE/article.html">如何绘制地理图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Networks/240805-%E5%9F%BA%E4%BA%8ENetworkx%E7%9A%84%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%92%8C%E7%BB%98%E5%9B%BE/article.html">基于Networkx的网络分析和绘图</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Quant/%E7%9B%AE%E5%BD%95.html">Quant</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Quant/230501-%E5%90%91%E9%87%8F%E5%8C%96%E5%9B%9E%E6%B5%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%AE%BE%E8%AE%A1/article.html">向量化回测系统的设计</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Risk/Financial_Risk_Forecasting_in_Python.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Introduction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Introduction</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix-an-introduction-to-python">Appendix: An Introduction to Python</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-1-financial-markets-prices-and-risk">Chapter 1: Financial Markets, Prices and Risk</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-2-univariate-volatility-modelling">Chapter 2: Univariate Volatility Modelling</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-3-multivariate-volatility-models">Chapter 3: Multivariate Volatility Models</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-4-risk-measures">Chapter 4: Risk Measures</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-5-implementing-risk-forecasts">Chapter 5: Implementing Risk Forecasts</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-6-analytical-value-at-risk-for-options-and-bonds">Chapter 6: Analytical Value-at-Risk for Options and Bonds</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-7-simulation-methods-for-var-for-options-and-bonds">Chapter 7: Simulation Methods for VaR for Options and Bonds</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-8-backtesting-and-stress-testing">Chapter 8: Backtesting and Stress Testing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-9-extreme-value-theory">Chapter 9: Extreme Value Theory</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h1>
<p>This notebook is an implementation of Jón Daníelsson’s <em>Financial Risk Forecasting</em> (Wiley, 2011) in Python 3.9.12, with annotations and introductory examples. The introductory examples (Appendix) are similar to Appendix B/C in the original book, with an emphasis on the differences between R/MATLAB and Python.</p>
<p>Bullet point numbers correspond to the R/MATLAB Listing numbers in the original book, referred to henceforth as <em>FRF</em>.</p>
<p>More details can be found at the book website: https://www.financialriskforecasting.com/</p>
<p>Last updated: June 2022</p>
<p>Copyright 2011-2020 Jón Daníelsson. This code is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This code is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. The GNU General Public License is available at: https://www.gnu.org/licenses/.</p>
<p><a id='top'></a></p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="#0"><span class="xref myst">Chapter 0. Appendix - Introduction</span></a> <br>
<a class="reference internal" href="#1"><span class="xref myst">Chapter 1. Financial Markets, Prices and Risk</span></a> <br>
<a class="reference internal" href="#2"><span class="xref myst">Chapter 2. Univariate Volatility Modeling</span></a> <br>
<a class="reference internal" href="#3"><span class="xref myst">Chapter 3. Multivariate Volatility Models</span></a> <br>
<a class="reference internal" href="#4"><span class="xref myst">Chapter 4. Risk Measures</span></a> <br>
<a class="reference internal" href="#5"><span class="xref myst">Chapter 5. Implementing Risk Forecasts</span></a> <br>
<a class="reference internal" href="#6"><span class="xref myst">Chapter 6. Analytical Value-at-Risk for Options and Bonds</span></a> <br>
<a class="reference internal" href="#7"><span class="xref myst">Chapter 7. Simulation Methods for VaR for Options and Bonds</span></a> <br>
<a class="reference internal" href="#8"><span class="xref myst">Chapter 8. Backtesting and Stress Testing</span></a> <br>
<a class="reference internal" href="#9"><span class="xref myst">Chapter 9. Extreme Value Theory</span></a> <br></p>
<p><a id='0'></a></p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="appendix-an-introduction-to-python">
<h1>Appendix: An Introduction to Python<a class="headerlink" href="#appendix-an-introduction-to-python" title="Link to this heading">#</a></h1>
<p>Created in Python 3.9.12 (June 2022)</p>
<ul class="simple">
<li><p>P.1: Entering and Printing Data</p></li>
<li><p>P.2: Vectors, Matrices and Sequences</p></li>
<li><p>P.3: Importing Data (to be updated)</p></li>
<li><p>P.4: Basic Summary Statistics</p></li>
<li><p>P.5: Calculating Moments</p></li>
<li><p>P.6: Basic Matrix Operations</p></li>
<li><p>P.7: Statistical Distributions</p></li>
<li><p>P.8: Statistical Tests</p></li>
<li><p>P.9: Time Series</p></li>
<li><p>P.10: Loops and Functions</p></li>
<li><p>P.11: Basic Graphs</p></li>
<li><p>P.12: Miscellaneous Useful Functions</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Entering and Printing Data in Python</span>
<span class="c1"># Listing P.1</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>             <span class="c1"># assign x the value 10</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>           <span class="c1"># print the value of x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Vectors, Matrices and Sequences in Python</span>
<span class="c1"># Listing P.2</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>       <span class="c1"># lists in square brackets are stored as arrays</span>

<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>           <span class="c1"># 3rd element (Python indices start at 0)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>         <span class="c1"># as expected, y has length 5</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>    <span class="c1"># NumPy: Numeric Python package</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="c1"># create a 2x3 matrix with NaN values</span>

<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>           

<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>        <span class="c1"># as expected, v is size (2,3)</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># repeats thrice by rows, twice by columns</span>

<span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>         <span class="c1"># an iterator from 0 to 9</span>

<span class="nb">print</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span> <span class="c1"># return  elements using list comprehension</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 3, 5, 7, 9]
5
5
[[nan nan nan]
 [nan nan nan]]
(2, 3)
[[1 2 3 1 2 3]
 [1 2 3 1 2 3]
 [1 2 3 1 2 3]]
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic Summary Statistics in Python</span>
<span class="c1"># Listing P.3</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">9.26</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>          <span class="c1"># sum of all elements of y</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>          <span class="c1"># maximum value of y</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>          <span class="c1"># minimum value of y</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>      <span class="c1"># arithmetic mean</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>    <span class="c1"># median</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>       <span class="c1"># population variance</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>       <span class="c1"># covar matrix = sample variance for single vector</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>  <span class="c1"># corr matrix = [1] for single vector</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>      <span class="c1"># sort in ascending order</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>       <span class="c1"># natural log</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>32.4
15
3.14
8.1
7.13
20.791800000000002
27.722399999999997
1.0
[ 3.14  5.    9.26 15.  ]
[1.1442228  2.7080502  2.22570405 1.60943791]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculating Moments in Python</span>
<span class="c1"># Listing P.4</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>                        <span class="c1"># mean</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>                         <span class="c1"># variance</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ddof</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>               <span class="c1"># ddof = 1 for unbiased standard deviation</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>                     <span class="c1"># skewness</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">fisher</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span> <span class="c1"># fisher = False gives Pearson definition</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.1
20.791800000000002
5.265206548655049
0.47004939528995604
1.7153138938095185
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic Matrix Operations in Python</span>
<span class="c1"># Listing P.5</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>                   <span class="c1"># z is a 2 x 2 matrix</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>                             <span class="c1"># x is a 1 x 2 matrix</span>

<span class="c1">## Note: z * x is undefined since the two matrices are not conformable</span>

<span class="nb">print</span><span class="p">(</span><span class="n">z</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>                        <span class="c1"># this evaluates to a 2 x 1 matrix          </span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">z</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>               <span class="c1"># &quot;stacking&quot; z and x vertically</span>

<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">z</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># &quot;stacking&quot; z and x horizontally</span>

<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="c1">## note: dimensions must match along the combining axis</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 5]
 [11]]
[[1 2]
 [3 4]
 [1 2]]
[[1 2 1]
 [3 4 2]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statistical Distributions in Python</span>
<span class="c1"># Listing P.6</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>        <span class="c1"># specify a set of values, syntax arange(min, exclusive-max, step)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>   <span class="c1"># specify a set of probabilities</span>

<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>     <span class="c1"># element-wise inverse Normal quantile</span>

<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>      <span class="c1"># element-wise cdf under Student-t(4)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>   <span class="c1"># element-wise pdf under Chisq(2)</span>

<span class="c1">## One can also obtain pseudorandom samples from distributions using numpy.random</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_t</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>   <span class="c1"># Sampling 100 times from TDist with 5 df</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>              <span class="c1"># Sampling 50 times from a standard normal </span>

<span class="c1">## Given data, we obtain MLE estimates of parameters with stats:</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                    <span class="c1"># Fitting x to normal dist</span>

<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>                                 <span class="c1"># First element is mean, second sd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-1.28155157 -0.84162123 -0.52440051 -0.2533471   0.          0.2533471
  0.52440051  0.84162123  1.28155157]
[0.01997098 0.05805826 0.18695048 0.5        0.81304952 0.94194174
 0.98002902]
[0.         0.         0.         0.5        0.30326533 0.18393972
 0.11156508]
(-0.045879161987809274, 1.4544560879442023)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statistical Tests in Python</span>
<span class="c1"># Listing P.7</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_t</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>  <span class="c1"># Create dataset x</span>

<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>               <span class="c1"># Jarque-Bera test - prints statistic and p-value</span>
<span class="nb">print</span><span class="p">(</span><span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>         <span class="c1"># Ljung-Box test - prints array of statistics and p-values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque_beraResult(statistic=3.8010576599080963, pvalue=0.14948954376718215)
      lb_stat  lb_pvalue
1    1.678898   0.195071
2    1.735300   0.419937
3    3.187289   0.363640
4    3.200164   0.524904
5    3.589705   0.609860
6    3.620324   0.727898
7    4.015758   0.777961
8    4.489716   0.810461
9    6.731188   0.665084
10   8.994699   0.532607
11   9.408528   0.584238
12  10.445726   0.576919
13  10.545396   0.648842
14  10.546561   0.721232
15  12.563387   0.635981
16  16.422652   0.423872
17  16.471006   0.490724
18  16.669928   0.545898
19  18.047904   0.519241
20  20.970627   0.398863
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time Series in Python</span>
<span class="c1"># Listing P.8</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_t</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span>   <span class="c1"># Create hypothetical dataset y</span>

<span class="n">q1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">stattools</span><span class="o">.</span><span class="n">acf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>        <span class="c1"># autocorrelation for lags 1:20</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">q1</span><span class="p">)),</span> <span class="n">height</span> <span class="o">=</span> <span class="n">q1</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">q2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">stattools</span><span class="o">.</span><span class="n">pacf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>       <span class="c1"># partial autocorr for lags 1:20</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">q2</span><span class="p">)),</span> <span class="n">height</span> <span class="o">=</span> <span class="n">q2</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fe5159fd69e8c9585e8cfb640b258b9cbab03d9c06773301c4688f5655a16166.png" src="../_images/fe5159fd69e8c9585e8cfb640b258b9cbab03d9c06773301c4688f5655a16166.png" />
<img alt="../_images/06d829d655af030aed2265f9193c843b4b560e7751e79bbe040b34f2eb11715e.png" src="../_images/06d829d655af030aed2265f9193c843b4b560e7751e79bbe040b34f2eb11715e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loops and Functions in Python</span>
<span class="c1"># Listing P.9</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="c1">## For loops</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>      <span class="c1"># NOTE: range(start, end), end excluded</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>           <span class="c1"># range(3,8) iterates through [3,4,5,6,7)</span>

<span class="c1">## If-else loops</span>

<span class="n">X</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">if</span> <span class="n">X</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X is a multiple of 3&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X is not a multiple of 3&quot;</span><span class="p">)</span>

<span class="c1">## Functions (example: a simple excess kurtosis function)</span>

<span class="k">def</span> <span class="nf">excess_kurtosis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">excess</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>        <span class="c1"># note: excess optional, default = 3</span>
    <span class="n">m4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>          <span class="c1"># note: exponentiation in Python uses **</span>
    <span class="n">excess_kurt</span><span class="o">=</span><span class="n">m4</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="n">excess</span>
    <span class="k">return</span> <span class="n">excess_kurt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_t</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>     <span class="c1"># Create hypothetical dataset x</span>

<span class="nb">print</span><span class="p">(</span><span class="n">excess_kurtosis</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9
16
25
36
49
X is not a multiple of 3
0.3836589450732917
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic Graphs in Python</span>
<span class="c1"># Listing P.10</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_t</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1">## using Matplotlib to plot bar, line, histogram and scatter plots</span>
<span class="c1">## subplot(a,b,c) creates a axb grid and plots the next plot in position c</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">y</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/99d883533f201f507f0b91aaed866aa0fe6d7e1c19b2f5fb9b8162894bfdab19.png" src="../_images/99d883533f201f507f0b91aaed866aa0fe6d7e1c19b2f5fb9b8162894bfdab19.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Miscellaneous Useful Functions in Python</span>
<span class="c1"># Listing P.11</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="c1">## Convert objects from one type to another with int(), float() etc</span>
<span class="c1">## To check type, use type(object)</span>

<span class="n">x</span> <span class="o">=</span> <span class="mf">8.0</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;float&#39;&gt;
&lt;class &#39;int&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p><a id='1'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-1-financial-markets-prices-and-risk">
<h1>Chapter 1: Financial Markets, Prices and Risk<a class="headerlink" href="#chapter-1-financial-markets-prices-and-risk" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>1.1/1.2: Loading hypothetical stock prices, converting to returns, plotting returns</p></li>
<li><p>1.3/1.4: Summary statistics for returns timeseries</p></li>
<li><p>1.5/1.6: Autocorrelation function (ACF) plots, Ljung-Box test</p></li>
<li><p>1.7/1.8: Quantile-Quantile (QQ) plots</p></li>
<li><p>1.9/1.10: Correlation matrix between different stocks</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download S&amp;P500 data in Python</span>
<span class="c1"># Listing 1.1/1.2</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">price</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;index.csv&#39;</span><span class="p">,</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">skiprows</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">price</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;S&amp;P500 Returns&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a0c0f5be3c43e2702b9a6ee3215c1fe40e38f94155501cb0068946ba82c888b8.png" src="../_images/a0c0f5be3c43e2702b9a6ee3215c1fe40e38f94155501cb0068946ba82c888b8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample statistics in Python</span>
<span class="c1"># Listing 1.3/1.4</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">fisher</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00025815990082599837
0.010005728643763066
-0.10195548627302298
0.10673589502911707
0.1526332698963366
16.981171461092003
Jarque_beraResult(statistic=46251.44013954825, pvalue=0.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ACF plots and the Ljung-Box test in Python</span>
<span class="c1"># Listing 1.5/1.6</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>


<span class="n">q</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">stattools</span><span class="o">.</span><span class="n">acf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)),</span> <span class="n">height</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Autocorrelation of returns&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">stattools</span><span class="o">.</span><span class="n">acf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)),</span> <span class="n">height</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Autocorrelation of returns squared&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="nb">print</span> <span class="p">(</span><span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/75c50121742f9502909df535aba38c3679c0ca4c6c2f99937dbf6bd58704aa71.png" src="../_images/75c50121742f9502909df535aba38c3679c0ca4c6c2f99937dbf6bd58704aa71.png" />
<img alt="../_images/5a6eaf24899e5e776cdd11f9517f50dc9c92bacdefe7a25036a68587bde509fc.png" src="../_images/5a6eaf24899e5e776cdd11f9517f50dc9c92bacdefe7a25036a68587bde509fc.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      lb_stat     lb_pvalue
1    1.246528  2.642166e-01
2    1.496305  4.732401e-01
3    1.954356  5.819341e-01
4   10.568621  3.186477e-02
5   20.603885  9.621816e-04
6   23.745683  5.815970e-04
7   36.587087  5.615488e-06
8   37.313407  1.007743e-05
9   46.301167  5.294369e-07
10  47.172281  8.785189e-07
11  49.061384  9.224809e-07
12  50.401496  1.187518e-06
13  54.260693  5.445471e-07
14  54.559431  1.030404e-06
15  62.017528  1.131049e-07
16  73.970415  1.992008e-09
17  74.263010  3.930393e-09
18  87.933280  3.386148e-11
19  89.148138  4.694050e-11
20  93.488126  1.808801e-11
        lb_stat      lb_pvalue
1    225.318034   6.258153e-51
2    344.090460   1.912960e-75
3    430.941781   4.388691e-93
4    669.009996  1.786587e-143
5    827.745178  1.149887e-176
6   1040.356737  1.668589e-221
7   1075.998715  4.541978e-228
8   1157.115714  1.764649e-244
9   1176.923181  1.162342e-247
10  1315.830953  1.465726e-276
11  1426.796212  1.990767e-299
12  1543.177596   0.000000e+00
13  1624.028467   0.000000e+00
14  1706.491660   0.000000e+00
15  1783.006717   0.000000e+00
16  1891.534669   0.000000e+00
17  2188.962152   0.000000e+00
18  2304.986595   0.000000e+00
19  2381.915406   0.000000e+00
20  2543.047731   0.000000e+00
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># QQ plots in Python</span>
<span class="c1"># Listing 1.7/1.8</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">statsmodels.graphics.gofplots</span> <span class="kn">import</span> <span class="n">qqplot</span>

<span class="n">fig1</span> <span class="o">=</span> <span class="n">qqplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">fit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>               
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">fig2</span> <span class="o">=</span> <span class="n">qqplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">distargs</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,),</span> <span class="n">fit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/526d428dcf81d35ca1dbea0ba24adb4927f26c25e8b866c5854d900248fc6c19.png" src="../_images/526d428dcf81d35ca1dbea0ba24adb4927f26c25e8b866c5854d900248fc6c19.png" />
<img alt="../_images/16110f6f7b5b37977e42efea04093d4e5e04dfb3a2db8a150797387104ce2269.png" src="../_images/16110f6f7b5b37977e42efea04093d4e5e04dfb3a2db8a150797387104ce2269.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download stock prices in Python</span>
<span class="c1"># Listing 1.9/1.10</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>


<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;stocks.csv&#39;</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">skiprows</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="c1"># correlation matrix</span>

<span class="c1">## rowvar=False indicates that columns are variables</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1.         0.22968419 0.21261918]
 [0.22968419 1.         0.14505109]
 [0.21261918 0.14505109 1.        ]]
</pre></div>
</div>
</div>
</div>
<p><a id='2'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-2-univariate-volatility-modelling">
<h1>Chapter 2: Univariate Volatility Modelling<a class="headerlink" href="#chapter-2-univariate-volatility-modelling" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>2.1/2.2: GARCH and t-GARCH estimation</p></li>
<li><p>2.3/2.4: APARCH estimation (unavailable as of June 2018)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># START</span>
<span class="c1"># ARCH and GARCH estimation in Python</span>
<span class="c1"># Listing 2.1/2.2</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;index.csv&#39;</span><span class="p">,</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">skiprows</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">arch</span> <span class="kn">import</span> <span class="n">arch_model</span>   
<span class="c1">## using Kevin Sheppard&#39;s ARCH package for Python</span>

<span class="c1">## ARCH(1)</span>
<span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="s1">&#39;Zero&#39;</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">)</span>
<span class="n">arch1</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="c1">## ARCH(4)</span>
<span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="s1">&#39;Zero&#39;</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">)</span>
<span class="n">arch4</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>


<span class="c1">## GARCH(4,1)</span>
<span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="s1">&#39;Zero&#39;</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">)</span>
<span class="n">garch4_1</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="c1">## GARCH(1,1)</span>
<span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="s1">&#39;Zero&#39;</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">)</span>
<span class="n">garch1_1</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="c1">## t-GARCH(1,1)</span>
<span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="s1">&#39;Zero&#39;</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;StudentsT&#39;</span><span class="p">)</span>
<span class="n">tgarch1_1</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ARCH(1) model:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">arch1</span><span class="o">.</span><span class="n">summary</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ARCH(4) model:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">arch4</span><span class="o">.</span><span class="n">summary</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GARCH(4,1) model:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">garch4_1</span><span class="o">.</span><span class="n">summary</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GARCH(1,1) model:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">garch1_1</span><span class="o">.</span><span class="n">summary</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tGARCH(1,1) model:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tgarch1_1</span><span class="o">.</span><span class="n">summary</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ARCH(1) model: 
                         Zero Mean - ARCH Model Results                        
==============================================================================
Dep. Variable:                      y   R-squared:                       0.000
Mean Model:                 Zero Mean   Adj. R-squared:                  0.000
Vol Model:                       ARCH   Log-Likelihood:               -7670.48
Distribution:                  Normal   AIC:                           15345.0
Method:            Maximum Likelihood   BIC:                           15358.3
                                        No. Observations:                 5676
Date:                Mon, Jun 20 2022   Df Residuals:                     5676
Time:                        14:42:01   Df Model:                            0
                            Volatility Model                            
========================================================================
                 coef    std err          t      P&gt;|t|  95.0% Conf. Int.
------------------------------------------------------------------------
omega          0.6846  4.051e-02     16.900  4.511e-64 [  0.605,  0.764]
alpha[1]       0.3406  5.594e-02      6.088  1.143e-09 [  0.231,  0.450]
========================================================================

Covariance estimator: robust 

ARCH(4) model: 
                         Zero Mean - ARCH Model Results                        
==============================================================================
Dep. Variable:                      y   R-squared:                       0.000
Mean Model:                 Zero Mean   Adj. R-squared:                  0.000
Vol Model:                       ARCH   Log-Likelihood:               -7278.14
Distribution:                  Normal   AIC:                           14566.3
Method:            Maximum Likelihood   BIC:                           14599.5
                                        No. Observations:                 5676
Date:                Mon, Jun 20 2022   Df Residuals:                     5676
Time:                        14:42:01   Df Model:                            0
                             Volatility Model                             
==========================================================================
                 coef    std err          t      P&gt;|t|    95.0% Conf. Int.
--------------------------------------------------------------------------
omega          0.3892  3.601e-02     10.808  3.155e-27   [  0.319,  0.460]
alpha[1]       0.1788  3.608e-02      4.955  7.249e-07   [  0.108,  0.249]
alpha[2]       0.1539  3.143e-02      4.898  9.676e-07 [9.233e-02,  0.216]
alpha[3]       0.1711  5.084e-02      3.366  7.640e-04 [7.146e-02,  0.271]
alpha[4]       0.1432  3.428e-02      4.177  2.948e-05 [7.601e-02,  0.210]
==========================================================================

Covariance estimator: robust 

GARCH(4,1) model: 
                        Zero Mean - GARCH Model Results                        
==============================================================================
Dep. Variable:                      y   R-squared:                       0.000
Mean Model:                 Zero Mean   Adj. R-squared:                  0.000
Vol Model:                      GARCH   Log-Likelihood:               -6964.28
Distribution:                  Normal   AIC:                           13940.6
Method:            Maximum Likelihood   BIC:                           13980.4
                                        No. Observations:                 5676
Date:                Mon, Jun 20 2022   Df Residuals:                     5676
Time:                        14:42:01   Df Model:                            0
                               Volatility Model                              
=============================================================================
                 coef    std err          t      P&gt;|t|       95.0% Conf. Int.
-----------------------------------------------------------------------------
omega          0.0131  3.703e-03      3.539  4.010e-04  [5.848e-03,2.036e-02]
alpha[1]       0.0460  1.697e-02      2.711  6.708e-03  [1.274e-02,7.925e-02]
alpha[2]       0.0242  2.372e-02      1.019      0.308 [-2.231e-02,7.068e-02]
alpha[3]   9.6148e-10  2.998e-02  3.207e-08      1.000 [-5.877e-02,5.877e-02]
alpha[4]   3.5019e-10  2.442e-02  1.434e-08      1.000 [-4.787e-02,4.787e-02]
beta[1]        0.9162  1.361e-02     67.333      0.000      [  0.890,  0.943]
=============================================================================

Covariance estimator: robust 

GARCH(1,1) model: 
                        Zero Mean - GARCH Model Results                        
==============================================================================
Dep. Variable:                      y   R-squared:                       0.000
Mean Model:                 Zero Mean   Adj. R-squared:                  0.000
Vol Model:                      GARCH   Log-Likelihood:               -6965.88
Distribution:                  Normal   AIC:                           13937.8
Method:            Maximum Likelihood   BIC:                           13957.7
                                        No. Observations:                 5676
Date:                Mon, Jun 20 2022   Df Residuals:                     5676
Time:                        14:42:01   Df Model:                            0
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega          0.0128  3.353e-03      3.803  1.427e-04 [6.181e-03,1.932e-02]
alpha[1]       0.0668  8.769e-03      7.613  2.685e-14 [4.957e-02,8.394e-02]
beta[1]        0.9198  1.115e-02     82.503      0.000     [  0.898,  0.942]
============================================================================

Covariance estimator: robust 

tGARCH(1,1) model: 
                           Zero Mean - GARCH Model Results                           
====================================================================================
Dep. Variable:                            y   R-squared:                       0.000
Mean Model:                       Zero Mean   Adj. R-squared:                  0.000
Vol Model:                            GARCH   Log-Likelihood:               -6551.58
Distribution:      Standardized Student&#39;s t   AIC:                           13111.2
Method:                  Maximum Likelihood   BIC:                           13137.7
                                              No. Observations:                 5676
Date:                      Mon, Jun 20 2022   Df Residuals:                     5676
Time:                              14:42:01   Df Model:                            0
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega          0.0175  3.107e-03      5.640  1.696e-08 [1.143e-02,2.361e-02]
alpha[1]       0.0787  9.045e-03      8.702  3.264e-18 [6.098e-02,9.644e-02]
beta[1]        0.9048  9.727e-03     93.016      0.000     [  0.886,  0.924]
                              Distribution                              
========================================================================
                 coef    std err          t      P&gt;|t|  95.0% Conf. Int.
------------------------------------------------------------------------
nu             3.9448      0.210     18.752  1.861e-78 [  3.532,  4.357]
========================================================================

Covariance estimator: robust 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Advanced ARCH and GARCH estimation in Python</span>
<span class="c1"># Listing 2.3/2.4</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>
  

<span class="c1">## Leverage effects</span>
<span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="s1">&#39;Zero&#39;</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">)</span>
<span class="n">leverage_garch1_1</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="c1">## Power models, delta = 1</span>
<span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="s1">&#39;Zero&#39;</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="n">power</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">power_garch1_1</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Leverage effects:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">leverage_garch1_1</span><span class="o">.</span><span class="n">summary</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Power model:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">power_garch1_1</span><span class="o">.</span><span class="n">summary</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Leverage effects: 
                      Zero Mean - GJR-GARCH Model Results                      
==============================================================================
Dep. Variable:                      y   R-squared:                       0.000
Mean Model:                 Zero Mean   Adj. R-squared:                  0.000
Vol Model:                  GJR-GARCH   Log-Likelihood:               -6965.83
Distribution:                  Normal   AIC:                           13939.7
Method:            Maximum Likelihood   BIC:                           13966.2
                                        No. Observations:                 5676
Date:                Mon, Jun 20 2022   Df Residuals:                     5676
Time:                        14:42:02   Df Model:                            0
                               Volatility Model                              
=============================================================================
                 coef    std err          t      P&gt;|t|       95.0% Conf. Int.
-----------------------------------------------------------------------------
omega          0.0128  3.349e-03      3.813  1.371e-04  [6.207e-03,1.934e-02]
alpha[1]       0.0656  1.207e-02      5.435  5.491e-08  [4.192e-02,8.922e-02]
gamma[1]   2.4769e-03  1.632e-02      0.152      0.879 [-2.950e-02,3.446e-02]
beta[1]        0.9197  1.108e-02     83.014      0.000      [  0.898,  0.941]
=============================================================================

Covariance estimator: robust 

Power model: 
                       Zero Mean - AVGARCH Model Results                       
==============================================================================
Dep. Variable:                      y   R-squared:                       0.000
Mean Model:                 Zero Mean   Adj. R-squared:                  0.000
Vol Model:                    AVGARCH   Log-Likelihood:               -7000.79
Distribution:                  Normal   AIC:                           14007.6
Method:            Maximum Likelihood   BIC:                           14027.5
                                        No. Observations:                 5676
Date:                Mon, Jun 20 2022   Df Residuals:                     5676
Time:                        14:42:02   Df Model:                            0
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega          0.0189  6.881e-03      2.741  6.126e-03 [5.374e-03,3.235e-02]
alpha[1]       0.0795  1.137e-02      6.997  2.606e-12   [5.725e-02,  0.102]
beta[1]        0.9205  1.579e-02     58.312      0.000     [  0.890,  0.951]
============================================================================

Covariance estimator: robust 
</pre></div>
</div>
</div>
</div>
<p><a id='3'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-3-multivariate-volatility-models">
<h1>Chapter 3: Multivariate Volatility Models<a class="headerlink" href="#chapter-3-multivariate-volatility-models" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>3.1/3.2: Loading hypothetical stock prices</p></li>
<li><p>3.3/3.4: EWMA estimation</p></li>
<li><p>3.5/3.6: OGARCH estimation (unavailable as of June 2018)</p></li>
<li><p>3.7/3.8: DCC estimation (unavailable as of June 2018)</p></li>
<li><p>3.9/3.10: Comparison of EWMA, OGARCH, DCC (unavailable as of June 2018)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download stock prices in Python</span>
<span class="c1"># Listing 3.1/3.2</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;stocks.csv&#39;</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>                          <span class="c1"># consider first two stocks</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> <span class="c1"># calculate returns</span>

<span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>         <span class="c1"># subtract mean</span>
<span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># EWMA in Python</span>
<span class="c1"># Listing 3.3/3.4</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="n">EWMA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="n">T</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="n">lmbda</span> <span class="o">=</span> <span class="mf">0.94</span>

<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">rowvar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">EWMA</span><span class="p">[</span><span class="mi">0</span><span class="p">,]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">lmbda</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lmbda</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">EWMA</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span> <span class="o">=</span> <span class="p">[</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>

<span class="n">EWMArho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">EWMA</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">EWMA</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">EWMA</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">EWMArho</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.22968419 0.22363473 0.22182769 ... 0.34366321 0.31227409 0.31597027]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># OGARCH in Python</span>
<span class="c1"># Listing 3.5/3.6</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="c1">## Python does not have a proper OGARCH package at present</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># DCC in Python</span>
<span class="c1"># Listing 3.7/3.8</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="c1">## Python does not have a proper DCC package at present</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Correlation comparison in Python</span>
<span class="c1"># Listing 3.9/3.10</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="c1">## Python does not have a proper OGARCH/DCC package at present</span>
</pre></div>
</div>
</div>
</div>
<p><a id='4'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-4-risk-measures">
<h1>Chapter 4: Risk Measures<a class="headerlink" href="#chapter-4-risk-measures" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>4.1/4.2: Expected Shortfall (ES) estimation under normality assumption</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ES in Python</span>
<span class="c1"># Listing 4.1/4.2</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">]</span>
<span class="n">VaR</span> <span class="o">=</span> <span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">ES</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="n">p</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VaR &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;%: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">VaR</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ES &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;%: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ES</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VaR 50.0%: -0.0
ES 50.0%: 0.798 

VaR 10.0%: 1.282
ES 10.0%: 1.755 

VaR 5.0%: 1.645
ES 5.0%: 2.063 

VaR 2.5%: 1.96
ES 2.5%: 2.338 

VaR 1.0%: 2.326
ES 1.0%: 2.665 

VaR 0.1%: 3.09
ES 0.1%: 3.367 
</pre></div>
</div>
</div>
</div>
<p><a id='5'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-5-implementing-risk-forecasts">
<h1>Chapter 5: Implementing Risk Forecasts<a class="headerlink" href="#chapter-5-implementing-risk-forecasts" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>5.1/5.2: Loading hypothetical stock prices, converting to returns</p></li>
<li><p>5.3/5.4: Univariate HS Value at Risk (VaR)</p></li>
<li><p>5.5/5.6: Multivariate HS VaR</p></li>
<li><p>5.7/5.8: Univariate ES VaR</p></li>
<li><p>5.9/5.10: Normal VaR</p></li>
<li><p>5.11/5.12: Portfolio Normal VaR</p></li>
<li><p>5.13/5.14: Student-t VaR</p></li>
<li><p>5.15/5.16: Normal ES VaR</p></li>
<li><p>5.17/5.18: Direct Integration Normal ES VaR</p></li>
<li><p>5.19/5.20: MA Normal VaR</p></li>
<li><p>5.21/5.22: EWMA VaR</p></li>
<li><p>5.23/5.24: Two-asset EWMA VaR</p></li>
<li><p>5.25/5.26: GARCH(1,1) VaR</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download stock prices in Python</span>
<span class="c1"># Listing 5.1/5.2</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;stocks.csv&#39;</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>      <span class="c1"># consider two stocks</span>
<span class="c1">## convert prices to returns, and adjust length</span>

<span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">value</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># portfolio value</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1"># probability</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Univariate HS in Python</span>
<span class="c1"># Listing 5.3/5.4</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>

<span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="c1"># sort returns</span>
<span class="n">op</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>    <span class="c1"># p percent smallest</span>
<span class="n">VaR1</span> <span class="o">=</span> <span class="o">-</span><span class="n">ys</span><span class="p">[</span><span class="n">op</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="n">VaR1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.498224747930724
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multivariate HS in Python</span>
<span class="c1"># Listing 5.5/5.6</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]</span>               <span class="c1"># vector of portfolio weights</span>
<span class="n">yp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span> <span class="c1"># portfolio returns</span>
<span class="n">yps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">yp</span><span class="p">)</span>
<span class="n">VaR2</span><span class="o">=</span> <span class="o">-</span><span class="n">yps</span><span class="p">[</span><span class="n">op</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="n">VaR2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>18.726262569293546
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Univariate ES in Python</span>
<span class="c1"># Listing 5.7/5.8</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="n">ES1</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ys</span><span class="p">[:</span><span class="n">op</span><span class="p">])</span> <span class="o">*</span> <span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ES1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22.56338810381287
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal VaR in Python</span>
<span class="c1"># Listing 5.9/5.10</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># estimate volatility</span>
<span class="n">VaR3</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span> 

<span class="nb">print</span><span class="p">(</span><span class="n">VaR3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>14.94957154354662
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Portfolio normal VaR in Python</span>
<span class="c1"># Listing 5.11/5.12</span>
<span class="c1"># Last updated June 2022</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="c1">## portfolio volatility</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">w</span><span class="p">)))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    
<span class="c1">## Note: [0,0] is to pull the first element of the matrix out as a float</span>
<span class="n">VaR4</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span> 

<span class="nb">print</span><span class="p">(</span><span class="n">VaR4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.041085456523806
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Student-t VaR in Python</span>
<span class="c1"># Listing 5.13/5.14</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="n">scy1</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">*</span> <span class="mi">100</span>         <span class="c1"># scale the returns</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scy1</span><span class="p">)</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>      <span class="c1"># rescale volatility</span>
<span class="n">nu</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">VaR5</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">nu</span><span class="p">)</span><span class="o">*</span><span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="n">VaR5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.123433115229002
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal ES in Python</span>
<span class="c1"># Listing 5.15/5.16</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ES2</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="o">/</span> <span class="n">p</span> <span class="o">*</span> <span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ES2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.127193705870486
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Direct integration ES in Python</span>
<span class="c1"># Listing 5.17/5.18</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>

<span class="n">VaR</span> <span class="o">=</span> <span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">q</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">ES</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">VaR</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">p</span> <span class="o">*</span> <span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.12719370586835
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MA normal VaR in Python</span>
<span class="c1"># Listing 5.19/5.20</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="n">WE</span> <span class="o">=</span> <span class="mi">20</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">t</span><span class="o">-</span><span class="n">WE</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">y1</span><span class="p">[</span><span class="n">t1</span><span class="p">:</span><span class="n">t</span><span class="p">]</span>      <span class="c1"># estimation window</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">VaR6</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">value</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">VaR6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16.05049679536141
16.149103169475975
18.854346063820373
18.882124798913356
16.230531751938656
16.169762107305665
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># EWMA VaR in Python</span>
<span class="c1"># Listing 5.21/5.22</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="n">lmbda</span> <span class="o">=</span> <span class="mf">0.94</span>
<span class="n">s11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">y1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">30</span><span class="p">],</span> <span class="n">ddof</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>     <span class="c1"># initial variance</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">s11</span> <span class="o">=</span> <span class="n">lmbda</span><span class="o">*</span><span class="n">s11</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lmbda</span><span class="p">)</span><span class="o">*</span><span class="n">y1</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>

<span class="n">VaR7</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="n">VaR7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16.75344387500228
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Two-asset EWMA VaR in Python</span>
<span class="c1"># Listing 5.23/5.24</span>
<span class="c1"># Last updated June 2022</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="c1">## s is the initial covariance</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">rowvar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">lmbda</span><span class="o">*</span><span class="n">s</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lmbda</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">w</span><span class="p">)))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">## Note: [0,0] is to pull the first element of the matrix out as a float</span>

<span class="n">VaR8</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="n">VaR8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20.50363287336398
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># GARCH VaR in Python</span>
<span class="c1"># Listing 5.25/5.26</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="kn">from</span> <span class="nn">arch</span> <span class="kn">import</span> <span class="n">arch_model</span> 

<span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="s1">&#39;Zero&#39;</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="n">rescale</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;omega&#39;</span><span class="p">]</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;alpha[1]&#39;</span><span class="p">]</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;beta[1]&#39;</span><span class="p">]</span>
<span class="c1">## computing sigma2 for t+1</span>
<span class="n">sigma2</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">y1</span><span class="p">[</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">res</span><span class="o">.</span><span class="n">conditional_volatility</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>

<span class="n">VaR9</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="n">VaR9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16.54281744634769
</pre></div>
</div>
</div>
</div>
<p><a id='6'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-6-analytical-value-at-risk-for-options-and-bonds">
<h1>Chapter 6: Analytical Value-at-Risk for Options and Bonds<a class="headerlink" href="#chapter-6-analytical-value-at-risk-for-options-and-bonds" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>6.1/6.2: Black-Scholes function definition</p></li>
<li><p>6.3/6.4: Black-Scholes option price calculation example</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Black-Scholes function in Python</span>
<span class="c1"># Listing 6.1/6.2</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="k">def</span> <span class="nf">bs</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P</span><span class="o">/</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="n">Call</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">-</span> <span class="n">X</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
    <span class="n">Put</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">)</span> <span class="o">-</span> <span class="n">P</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span>
    
    <span class="n">Delta_Call</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
    <span class="n">Delta_Put</span> <span class="o">=</span> <span class="n">Delta_Call</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">Gamma</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Call&quot;</span><span class="p">:</span> <span class="n">Call</span><span class="p">,</span> <span class="s2">&quot;Put&quot;</span><span class="p">:</span> <span class="n">Put</span><span class="p">,</span> <span class="s2">&quot;Delta_Call&quot;</span><span class="p">:</span> <span class="n">Delta_Call</span><span class="p">,</span> <span class="s2">&quot;Delta_Put&quot;</span><span class="p">:</span> <span class="n">Delta_Put</span><span class="p">,</span> <span class="s2">&quot;Gamma&quot;</span><span class="p">:</span> <span class="n">Gamma</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Black-Scholes in Python</span>
<span class="c1"># Listing 6.3/6.4</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="n">f</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Call&#39;: 13.498517482637212, &#39;Put&#39;: 1.2764095651871656, &#39;Delta_Call&#39;: 0.8395228492806657, &#39;Delta_Put&#39;: -0.16047715071933433, &#39;Gamma&#39;: 0.017238257785615545}
</pre></div>
</div>
</div>
</div>
<p><a id='7'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-7-simulation-methods-for-var-for-options-and-bonds">
<h1>Chapter 7: Simulation Methods for VaR for Options and Bonds<a class="headerlink" href="#chapter-7-simulation-methods-for-var-for-options-and-bonds" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>7.1/7.2: Plotting normal distribution transformation</p></li>
<li><p>7.3/7.4: Random number generation from Uniform(0,1), Normal(0,1)</p></li>
<li><p>7.5/7.6: Bond pricing using yield curve</p></li>
<li><p>7.7/7.8: Yield curve simulations</p></li>
<li><p>7.9/7.10: Bond price simulations</p></li>
<li><p>7.11/7.12: Black-Scholes analytical pricing of call</p></li>
<li><p>7.13/7.14: Black-Scholes Monte Carlo simulation pricing of call</p></li>
<li><p>7.15/7.16: Option density plots</p></li>
<li><p>7.17/7.18: VaR simulation of portfolio with only underlying</p></li>
<li><p>7.19/7.20: VaR simulation of portfolio with only call</p></li>
<li><p>7.21/7.22: VaR simulation of portfolio with call, put and underlying</p></li>
<li><p>7.23/7.24: Simulated two-asset returns</p></li>
<li><p>7.25/7.26: Two-asset portfolio VaR</p></li>
<li><p>7.27/7.28: Two-asset portfolio VaR with a call</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Transformation in Python</span>
<span class="c1"># Listing 7.1/7.2</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mf">3.1</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="c1"># Python&#39;s arange excludes the last value</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;CDF of Normal distribution&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6a2ce887edcd68c668243763f339c67ba2aa60dc280056d08cbbd3d465cc64c9.png" src="../_images/6a2ce887edcd68c668243763f339c67ba2aa60dc280056d08cbbd3d465cc64c9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Various RNs in Python</span>
<span class="c1"># Listing 7.3/7.4</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>


<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>     <span class="c1"># set seed</span>
<span class="n">S</span> <span class="o">=</span> <span class="mi">10</span>                 <span class="c1"># simulation size</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="n">S</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="n">S</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_t</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="n">S</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.15416284 0.7400497  0.26331502 0.53373939 0.01457496 0.91874701
 0.90071485 0.03342143 0.95694934 0.13720932]
[ 0.75314283 -1.53472134  0.00512708 -0.12022767 -0.80698188  2.87181939
 -0.59782292  0.47245699  1.09595612 -1.2151688 ]
[ 1.54289086  0.69652904  0.52148112 -0.25218158 -4.66442107 -2.42642183
  0.27546574 -2.17082333  1.29967088  1.7842616 ]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Price bond in Python</span>
<span class="c1"># Listing 7.5/7.6</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>


<span class="n">yield_c</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.00</span><span class="p">,</span> <span class="mf">5.69</span><span class="p">,</span> <span class="mf">6.09</span><span class="p">,</span> <span class="mf">6.38</span><span class="p">,</span> <span class="mf">6.61</span><span class="p">,</span> 
           <span class="mf">6.79</span><span class="p">,</span> <span class="mf">6.94</span><span class="p">,</span> <span class="mf">7.07</span><span class="p">,</span> <span class="mf">7.19</span><span class="p">,</span> <span class="mf">7.30</span><span class="p">]</span>    <span class="c1"># yield curve</span>

<span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yield_c</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.07</span>                                    <span class="c1"># initial yield rate</span>
<span class="n">Par</span> <span class="o">=</span> <span class="mi">10</span>                                    <span class="c1"># par value</span>
<span class="n">coupon</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">Par</span>                            <span class="c1"># coupon payments </span>
<span class="n">cc</span> <span class="o">=</span> <span class="p">[</span><span class="n">coupon</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>                          <span class="c1"># vector of cash flows</span>
<span class="n">cc</span><span class="p">[</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Par</span>                              <span class="c1"># add par to cash flows</span>
<span class="n">P</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cc</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">yield_c</span><span class="p">,</span><span class="mi">100</span><span class="p">)),</span>
                      <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)))))</span> <span class="c1"># calc price</span>

<span class="nb">print</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.913205732444842
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate yields in Python</span>
<span class="c1"># Listing 7.7/7.8</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>


<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>                   <span class="c1"># set seed</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.5</span>                          <span class="c1"># daily yield volatility</span>
<span class="n">S</span> <span class="o">=</span> <span class="mi">8</span>                                <span class="c1"># number of simulations</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">S</span><span class="p">)</span> <span class="c1"># generate random numbers</span>

<span class="n">ysim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span><span class="n">S</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
    <span class="n">ysim</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yield_c</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ysim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Simulated yield curves&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/562d70421fbecddb71fae2ec2cd7ab380c7c9d10bc777345cd6e14e20e87b1a1.png" src="../_images/562d70421fbecddb71fae2ec2cd7ab380c7c9d10bc777345cd6e14e20e87b1a1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate bond prices in Python</span>
<span class="c1"># Listing 7.9/7.10</span>
<span class="c1"># Last updated November 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>


<span class="n">S</span> <span class="o">=</span> <span class="mi">8</span>                   <span class="c1"># simulation size</span>
<span class="n">SP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">S</span><span class="p">])</span>      <span class="c1"># initializing vector with zeros</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>      <span class="c1"># S simulations</span>
    <span class="n">SP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cc</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">ysim</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)))))</span>

<span class="n">SP</span> <span class="o">-=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span> <span class="c1"># correct for mean</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">SP</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Simulated bond prices, S = 8&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">S</span> <span class="o">=</span> <span class="mi">50000</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">S</span><span class="p">)</span>

<span class="n">ysim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span><span class="n">S</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
    <span class="n">ysim</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yield_c</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">SP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">S</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>     
    <span class="n">SP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cc</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">ysim</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)))))</span>
    
<span class="n">SP</span> <span class="o">-=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="nb">range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">density</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">fitted_norm</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">SP</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> <span class="n">fitted_norm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histogram for simulated bond prices, S = 50000&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4e1a4d799c3c58aac46363055656ae89f246f21289e496c659b57b943da950ff.png" src="../_images/4e1a4d799c3c58aac46363055656ae89f246f21289e496c659b57b943da950ff.png" />
<img alt="../_images/3a6b583544385683854bafc5763a9017eeb1bf0a46e1740e01890ae4d8928b36.png" src="../_images/3a6b583544385683854bafc5763a9017eeb1bf0a46e1740e01890ae4d8928b36.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Black-Scholes valuation in Python</span>
<span class="c1"># Listing 7.11/7.12</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="c1">## This calculation uses the Black-Scholes pricing function (Listing 6.1/6.2)</span>
<span class="n">P0</span> <span class="o">=</span> <span class="mi">50</span>                     <span class="c1"># initial spot price</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.2</span>                 <span class="c1"># annual volatility</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.05</span>                    <span class="c1"># annual interest</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.5</span>                     <span class="c1"># time to expiration</span>
<span class="n">X</span> <span class="o">=</span> <span class="mi">40</span>                      <span class="c1"># strike price</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>  <span class="c1"># analytical call price</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Call&#39;: 11.087280700718757, &#39;Put&#39;: 0.09967718185206187, &#39;Delta_Call&#39;: 0.9660259272621473, &#39;Delta_Put&#39;: -0.03397407273785269, &#39;Gamma&#39;: 0.010663779610020534}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Black-Scholes simulation in Python</span>
<span class="c1"># Listing 7.13/7.14</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>


<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>          <span class="c1"># set seed</span>
<span class="n">S</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span>                   <span class="c1"># number of simulations</span>
<span class="n">ysim</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="p">,</span>
                      <span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="n">S</span><span class="p">)</span> <span class="c1"># sim returns, lognorm corrected</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ysim</span><span class="p">)</span>          <span class="c1"># sim future prices</span>
<span class="n">SP</span> <span class="o">=</span> <span class="n">F</span> <span class="o">-</span> <span class="n">X</span>                  <span class="c1"># payoff</span>
<span class="n">SP</span><span class="p">[</span><span class="n">SP</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>              <span class="c1"># set negative outcomes to zero</span>
<span class="n">fsim</span> <span class="o">=</span> <span class="n">SP</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>  <span class="c1"># discount</span>
<span class="n">call_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fsim</span><span class="p">)</span>    <span class="c1"># simulated price</span>
<span class="nb">print</span><span class="p">(</span><span class="n">call_sim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11.068936888001415
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option density plots in Python</span>
<span class="c1"># Listing 7.15/7.16</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>


<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="nb">range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">80</span><span class="p">),</span> <span class="n">density</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">fitted_norm</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">F</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span> <span class="n">fitted_norm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Density of future prices&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fsim</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="nb">range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span> <span class="n">density</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Call&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Density of Call option prices&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6564b3890d34b817d8244b79be22338fa0c87750686905163c1efc582f855a1d.png" src="../_images/6564b3890d34b817d8244b79be22338fa0c87750686905163c1efc582f855a1d.png" />
<img alt="../_images/c871346c6019a92f1c5c95f8643465b435860caf45aabeac2f8fa3f9913a47c4.png" src="../_images/c871346c6019a92f1c5c95f8643465b435860caf45aabeac2f8fa3f9913a47c4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate VaR in Python</span>
<span class="c1"># Listing 7.17/7.18</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       <span class="c1"># set seed</span>
<span class="n">S</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">7</span>               <span class="c1"># number of simulations</span>
<span class="n">s2</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">**</span><span class="mi">2</span>            <span class="c1"># daily variance</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.01</span>                <span class="c1"># probability</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.05</span>                <span class="c1"># annual riskfree rate</span>
<span class="n">P</span> <span class="o">=</span> <span class="mi">100</span>                 <span class="c1"># price today</span>
<span class="n">ysim</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="mi">365</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">s2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s2</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="n">S</span><span class="p">)</span> <span class="c1"># sim returns</span>
<span class="n">Psim</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ysim</span><span class="p">)</span> <span class="c1"># sim future prices</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">Psim</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span>   <span class="c1"># simulated P/L</span>
<span class="n">VaR1</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">ceil</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">VaR1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.290784802622909
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate option VaR in Python</span>
<span class="c1"># Listing 7.19/7.20</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>



<span class="n">T</span> <span class="o">=</span> <span class="mf">0.25</span>       <span class="c1"># time to expiration</span>
<span class="n">X</span> <span class="o">=</span> <span class="mi">100</span>                                 <span class="c1"># strike price</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s2</span> <span class="o">*</span> <span class="mi">250</span><span class="p">)</span>               <span class="c1"># annual volatility</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>               <span class="c1"># analytical call price</span>
<span class="n">fsim</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Psim</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">365</span><span class="p">))</span> <span class="c1"># sim option prices</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">fsim</span><span class="p">[</span><span class="s1">&#39;Call&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Call&#39;</span><span class="p">])</span>     <span class="c1"># simulated P/L</span>
<span class="n">VaR2</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">ceil</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> 

<span class="nb">print</span><span class="p">(</span><span class="n">VaR2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.2150728853608541
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example 7.3 in Python</span>
<span class="c1"># Listing 7.21/7.22</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>


<span class="n">X1</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">X2</span> <span class="o">=</span> <span class="mi">110</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
<span class="n">f2sim</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">Psim</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">365</span><span class="p">))</span>
<span class="n">f1sim</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">Psim</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">365</span><span class="p">))</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">f1sim</span><span class="p">[</span><span class="s1">&#39;Call&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">f2sim</span><span class="p">[</span><span class="s1">&#39;Put&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Psim</span> <span class="o">-</span> <span class="n">f1</span><span class="p">[</span><span class="s1">&#39;Call&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">f2</span><span class="p">[</span><span class="s1">&#39;Put&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span>
<span class="n">VaR3</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">ceil</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">VaR3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.4952375118324568
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulated two-asset returns in Python</span>
<span class="c1"># Listing 7.23/7.24</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#</span>


<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>                                      <span class="c1"># set seed</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">r</span><span class="o">/</span><span class="mi">365</span><span class="p">,</span> <span class="n">r</span><span class="o">/</span><span class="mi">365</span><span class="p">])</span>                       <span class="c1"># return mean</span>
<span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.0005</span><span class="p">],[</span><span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">]])</span>      <span class="c1"># covariance matrix</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">S</span><span class="p">)</span>  <span class="c1"># simulated returns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Two-asset VaR in Python</span>
<span class="c1"># Listing 7.25/7.26</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy.matlib</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>              <span class="c1"># prices</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>                 <span class="c1"># number of assets</span>
<span class="n">Port</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>                 <span class="c1"># portfolio at t</span>
<span class="n">Psim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matlib</span><span class="o">.</span><span class="n">repmat</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="c1"># simulated prices</span>
<span class="n">PortSim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Psim</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>           <span class="c1"># simulated portfolio value</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">PortSim</span> <span class="o">-</span> <span class="n">Port</span><span class="p">)</span>            <span class="c1"># simulated P/L</span>
<span class="n">VaR4</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">ceil</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">VaR4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>25.942795557394135
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A two-asset case in Python with an option</span>
<span class="c1"># Listing 7.27/7.28</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>


<span class="n">f</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="p">)</span>
<span class="n">fsim</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span> <span class="o">=</span> <span class="n">Psim</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">365</span><span class="p">))</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">fsim</span><span class="p">[</span><span class="s1">&#39;Call&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Psim</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Call&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">VaR5</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">ceil</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">VaR5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20.777617782200394
</pre></div>
</div>
</div>
</div>
<p><a id='8'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-8-backtesting-and-stress-testing">
<h1>Chapter 8: Backtesting and Stress Testing<a class="headerlink" href="#chapter-8-backtesting-and-stress-testing" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>8.1/8.2: Loading hypothetical stock prices, converting to returns</p></li>
<li><p>8.3/8.4: Setting up backtest</p></li>
<li><p>8.5/8.6: Running backtest for EWMA/MA/HS/GARCH VaR</p></li>
<li><p>8.7/8.8: Backtesting analysis for EWMA/MA/HS/GARCH VaR</p></li>
<li><p>8.9/8.10: Bernoulli coverage test</p></li>
<li><p>8.11/8.12: Independence test</p></li>
<li><p>8.13/8.14: Running Bernoulli/Independence test on backtests</p></li>
<li><p>8.15/8.16: Running backtest for EWMA/HS ES</p></li>
<li><p>8.17/8.18: Backtesting analysis for EWMA/HS ES</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data in Python</span>
<span class="c1"># Listing 8.1/8.2</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">price</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;index.csv&#39;</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">price</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># get returns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set backtest up in Python</span>
<span class="c1"># Listing 8.3/8.4</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>

<span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>                   <span class="c1"># number of obs for y</span>
<span class="n">WE</span> <span class="o">=</span> <span class="mi">1000</span>                    <span class="c1"># estimation window length</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.01</span>                     <span class="c1"># probability</span>
<span class="n">l1</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">WE</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>             <span class="c1"># HS observation</span>
<span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>                    <span class="c1"># portfolio value</span>
<span class="n">VaR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="n">T</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="c1"># matrix for forecasts</span>

<span class="c1">## EWMA setup</span>

<span class="n">lmbda</span> <span class="o">=</span> <span class="mf">0.94</span>
<span class="n">s11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">WE</span><span class="p">):</span>
    <span class="n">s11</span><span class="o">=</span><span class="n">lmbda</span><span class="o">*</span><span class="n">s11</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lmbda</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Running backtest in Python</span>
<span class="c1"># Listing 8.5/8.6</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">arch</span> <span class="kn">import</span> <span class="n">arch_model</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">WE</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span> 
    <span class="n">t1</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">WE</span>           <span class="c1"># start of data window</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span>            <span class="c1"># end of data window</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">t1</span><span class="p">:</span><span class="n">t2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>   <span class="c1"># data for estimation</span>

    <span class="n">s11</span> <span class="o">=</span> <span class="n">lmbda</span> <span class="o">*</span> <span class="n">s11</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lmbda</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">VaR</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span><span class="o">*</span><span class="n">value</span> <span class="c1"># EWMA</span>
 
    <span class="n">VaR</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">value</span> <span class="c1"># MA</span>

    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
    <span class="n">VaR</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">ys</span><span class="p">[</span><span class="n">l1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span> <span class="c1"># HS</span>

    <span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="s1">&#39;Zero&#39;</span><span class="p">,</span><span class="n">vol</span> <span class="o">=</span> <span class="s1">&#39;Garch&#39;</span><span class="p">,</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="n">rescale</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">show_warning</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">par</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">s4</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">par</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">window</span><span class="p">[</span><span class="n">WE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">par</span><span class="p">[</span>
        <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">res</span><span class="o">.</span><span class="n">conditional_volatility</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">VaR</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s4</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span> <span class="c1"># GARCH(1,1)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backtesting analysis in Python</span>
<span class="c1"># Listing 8.7/8.8</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="n">W1</span> <span class="o">=</span> <span class="n">WE</span> <span class="c1"># Python index starts at 0</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;EWMA&quot;</span><span class="p">,</span> <span class="s2">&quot;MA&quot;</span><span class="p">,</span> <span class="s2">&quot;HS&quot;</span><span class="p">,</span> <span class="s2">&quot;GARCH&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">VR</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">VaR</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">,</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">WE</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">VaR</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> 
           <span class="s2">&quot;Violation ratio:&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">VR</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> 
           <span class="s2">&quot;Volatility:&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">VaR</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Backtesting&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EWMA 
 Violation ratio: 2.074 
 Volatility: 0.012 

MA 
 Violation ratio: 1.861 
 Volatility: 0.007 

HS 
 Violation ratio: 1.24 
 Volatility: 0.012 

GARCH 
 Violation ratio: 1.54 
 Volatility: 0.01 
</pre></div>
</div>
<img alt="../_images/8bad620c3d247a208e10c3fb347f87e1f7a21d16dbdfef55a1668a049bb7e062.png" src="../_images/8bad620c3d247a208e10c3fb347f87e1f7a21d16dbdfef55a1668a049bb7e062.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bernoulli coverage test in Python</span>
<span class="c1"># Listing 8.9/8.10</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#</span>
    
<span class="k">def</span> <span class="nf">bern_test</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">sv</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    
    <span class="n">al</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">sv</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">lv</span><span class="o">-</span><span class="n">sv</span><span class="p">)</span>
    <span class="n">bl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sv</span><span class="o">/</span><span class="n">lv</span><span class="p">)</span><span class="o">*</span><span class="n">sv</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sv</span><span class="o">/</span><span class="n">lv</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">lv</span><span class="o">-</span><span class="n">sv</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">al</span><span class="o">-</span><span class="n">bl</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Independence test in Python</span>
<span class="c1"># Listing 8.11/8.12</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#</span>
    
<span class="k">def</span> <span class="nf">ind_test</span><span class="p">(</span><span class="n">V</span><span class="p">):</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="n">T</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">V_00</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">J</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">V_01</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">J</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">V_10</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">J</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">V_11</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">J</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span>
    
    <span class="n">p_00</span><span class="o">=</span><span class="n">V_00</span><span class="o">/</span><span class="p">(</span><span class="n">V_00</span><span class="o">+</span><span class="n">V_01</span><span class="p">)</span>
    <span class="n">p_01</span><span class="o">=</span><span class="n">V_01</span><span class="o">/</span><span class="p">(</span><span class="n">V_00</span><span class="o">+</span><span class="n">V_01</span><span class="p">)</span>
    <span class="n">p_10</span><span class="o">=</span><span class="n">V_10</span><span class="o">/</span><span class="p">(</span><span class="n">V_10</span><span class="o">+</span><span class="n">V_11</span><span class="p">)</span>
    <span class="n">p_11</span><span class="o">=</span><span class="n">V_11</span><span class="o">/</span><span class="p">(</span><span class="n">V_10</span><span class="o">+</span><span class="n">V_11</span><span class="p">)</span>
    
    <span class="n">hat_p</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_01</span><span class="o">+</span><span class="n">V_11</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">V_00</span><span class="o">+</span><span class="n">V_01</span><span class="o">+</span><span class="n">V_10</span><span class="o">+</span><span class="n">V_11</span><span class="p">)</span>
    <span class="n">al</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hat_p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">V_00</span><span class="o">+</span><span class="n">V_10</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">hat_p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">V_01</span><span class="o">+</span><span class="n">V_11</span><span class="p">)</span>
    <span class="n">bl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p_00</span><span class="p">)</span><span class="o">*</span><span class="n">V_00</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p_01</span><span class="p">)</span><span class="o">*</span><span class="n">V_01</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p_10</span><span class="p">)</span><span class="o">*</span><span class="n">V_10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p_11</span><span class="p">)</span><span class="o">*</span><span class="n">V_11</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">al</span><span class="o">-</span><span class="n">bl</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backtesting S&amp;P 500 in Python</span>
<span class="c1"># Listing 8.13/8.14</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1"># </span>

<span class="n">W1</span> <span class="o">=</span> <span class="n">WE</span>
<span class="n">ya</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">]</span>
<span class="n">VaRa</span> <span class="o">=</span> <span class="n">VaR</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">,]</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EWMA&#39;</span><span class="p">,</span> <span class="s1">&#39;MA&#39;</span><span class="p">,</span> <span class="s1">&#39;HS&#39;</span><span class="p">,</span> <span class="s1">&#39;GARCH&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">VaR</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">VaRa</span><span class="o">*</span><span class="mi">0</span>
    <span class="n">v</span><span class="p">[</span><span class="n">q</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ber</span> <span class="o">=</span> <span class="n">bern_test</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">ind_test</span><span class="p">(</span><span class="n">v</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
           <span class="s2">&quot;Bernoulli:&quot;</span><span class="p">,</span> <span class="s2">&quot;Test statistic =&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">ber</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;p-value =&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">ber</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span><span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
           <span class="s2">&quot;Independence:&quot;</span><span class="p">,</span> <span class="s2">&quot;Test statistic =&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;p-value =&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span><span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EWMA 
 Bernoulli: Test statistic = 41.626 p-value = 0.0 
 Independence: Test statistic = 0.441 p-value = 0.507 

MA 
 Bernoulli: Test statistic = 27.904 p-value = 0.0 
 Independence: Test statistic = 17.439 p-value = 0.0 

HS 
 Bernoulli: Test statistic = 2.535 p-value = 0.111 
 Independence: Test statistic = 11.483 p-value = 0.001 

GARCH 
 Bernoulli: Test statistic = 11.814 p-value = 0.001 
 Independence: Test statistic = 0.599 p-value = 0.439 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backtest ES in Python</span>
<span class="c1"># Listing 8.15/8.16</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="n">VaR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="n">T</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="c1"># VaR forecasts</span>
<span class="n">ES</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="n">T</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>  <span class="c1"># ES forecasts</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">WE</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">WE</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">t1</span><span class="p">:</span><span class="n">t2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">s11</span> <span class="o">=</span> <span class="n">lmbda</span> <span class="o">*</span> <span class="n">s11</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lmbda</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">VaR</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span><span class="o">*</span><span class="n">value</span>       <span class="c1"># EWMA</span>
    <span class="n">ES</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="n">p</span>

    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
    <span class="n">VaR</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">ys</span><span class="p">[</span><span class="n">l1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span>                           <span class="c1"># HS</span>
    <span class="n">ES</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">l1</span><span class="p">])</span> <span class="o">*</span> <span class="n">value</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ES in Python</span>
<span class="c1"># Listing 8.17/8.18</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1"># </span>
<span class="c1">#</span>

<span class="n">ESa</span> <span class="o">=</span> <span class="n">ES</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">,:]</span>
<span class="n">VaRa</span> <span class="o">=</span> <span class="n">VaR</span><span class="p">[</span><span class="n">W1</span><span class="p">:</span><span class="n">T</span><span class="p">,:]</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;EWMA&quot;</span><span class="p">,</span> <span class="s2">&quot;HS&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">ya</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">VaRa</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
    <span class="n">nES</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ya</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">/</span> <span class="o">-</span><span class="n">ESa</span><span class="p">[</span><span class="n">q</span><span class="p">,</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;nES = &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">nES</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EWMA nES =  1.224
HS nES =  1.054
</pre></div>
</div>
</div>
</div>
<p><a id='9'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-9-extreme-value-theory">
<h1>Chapter 9: Extreme Value Theory<a class="headerlink" href="#chapter-9-extreme-value-theory" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>9.1/9.2: Calculation of tail index from returns</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Hill estimator in Python</span>
<span class="c1"># Listing 9.1/9.2</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1"># </span>
<span class="c1">#   </span>

<span class="n">ysort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>                                <span class="c1"># sort the returns</span>
<span class="n">CT</span> <span class="o">=</span> <span class="mi">100</span>                                          <span class="c1"># set the threshold</span>
<span class="n">iota</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ysort</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">CT</span><span class="p">]</span><span class="o">/</span><span class="n">ysort</span><span class="p">[</span><span class="n">CT</span><span class="p">])))</span> <span class="c1"># get the tail index</span>

<span class="nb">print</span><span class="p">(</span><span class="n">iota</span><span class="p">)</span> 

<span class="c1"># END</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.62970984651441
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Risk"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Introduction</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix-an-introduction-to-python">Appendix: An Introduction to Python</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-1-financial-markets-prices-and-risk">Chapter 1: Financial Markets, Prices and Risk</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-2-univariate-volatility-modelling">Chapter 2: Univariate Volatility Modelling</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-3-multivariate-volatility-models">Chapter 3: Multivariate Volatility Models</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-4-risk-measures">Chapter 4: Risk Measures</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-5-implementing-risk-forecasts">Chapter 5: Implementing Risk Forecasts</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-6-analytical-value-at-risk-for-options-and-bonds">Chapter 6: Analytical Value-at-Risk for Options and Bonds</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-7-simulation-methods-for-var-for-options-and-bonds">Chapter 7: Simulation Methods for VaR for Options and Bonds</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-8-backtesting-and-stress-testing">Chapter 8: Backtesting and Stress Testing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-9-extreme-value-theory">Chapter 9: Extreme Value Theory</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FinX Lab
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>