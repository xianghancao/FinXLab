
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction &#8212; FinX Lab</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-examples.css?v=e236af4b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.bundle.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-shadow.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-punk.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-noir.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-light.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-borderless.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/micromodal.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/js/hoverxref.js"></script>
    <script src="../_static/js/tooltipster.bundle.min.js"></script>
    <script src="../_static/js/micromodal.min.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Risk/Financial_Risk_Forecasting_in_R';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../Home/home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/me.jpg" class="logo__image only-light" alt="FinX Lab - Home"/>
    <script>document.write(`<img src="../_static/me.jpg" class="logo__image only-dark" alt="FinX Lab - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../Home/home.html">
                    FinX Lab
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../AboutMe/%E7%9B%AE%E5%BD%95.html">About Me</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../AboutMe/Events/article.html">Events</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../NLP/%E7%9B%AE%E5%BD%95.html">NLP</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../NLP/241128-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/article.html">使用 DistilBERT 进行情感分析：基于预训练模型的实战</a></li>
<li class="toctree-l2"><a class="reference internal" href="../NLP/241130-%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%9F%A2%E9%87%8F%E5%8C%96%E4%B8%8EKeras%E4%B8%AD%E7%9A%84Tokenizer%E4%BD%BF%E7%94%A8/article.html">文本数据矢量化与Keras中的Tokenizer使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../NLP/241224-Word-metric%20method%20VS%20Semantic%20measure/article.html">Word-metric methods VS Semantic Models</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../FinancialEconomics/%E7%9B%AE%E5%BD%95.html">Financial Economics</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../FinancialEconomics/240410-KPPS%20H-Step-Ahead%20Forecast%20Error%20Variance%20Decomposition/article.html">KPPS H-Step-Ahead Forecast Error Variance Decomposition(FEVD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FinancialEconomics/240620-KPPS%20H%E6%AD%A5%E9%A2%84%E6%B5%8B%E8%AF%AF%E5%B7%AE%E6%96%B9%E5%B7%AE%E5%88%86%E8%A7%A3%E7%9A%84Python%E5%AE%9E%E7%8E%B0/article.html">KPPS H步预测误差方差分解的Python实现</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FinancialEconomics/240717-%E5%87%A0%E7%A7%8D%E6%B3%A2%E5%8A%A8%E7%8E%87%E7%9A%84%E8%AE%A1%E7%AE%97/article.html">几种波动率的计算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FinancialEconomics/230501-DY%20method/article.html">Diebold&amp;Yilmaz method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FinancialEconomics/230501-DCC-GARCH%E7%9A%84R%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0/article.html">DCC-GARCH的R语言实现</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Networks/%E7%9B%AE%E5%BD%95.html">Networks</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Networks/240718-%E7%BD%91%E7%BB%9C%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%A7%E5%9B%BE%E7%BB%98%E5%88%B6/article.html">网络的相关性图绘制</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Networks/240721-%E5%9F%BA%E4%BA%8EiGraph%E7%9A%84%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%92%8C%E7%BB%98%E5%9B%BE/article.html">基于iGraph的网络分析和绘图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Networks/240723-%E5%A6%82%E4%BD%95%E7%BB%98%E5%88%B6%E5%9C%B0%E7%90%86%E5%9B%BE/article.html">如何绘制地理图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Networks/240805-%E5%9F%BA%E4%BA%8ENetworkx%E7%9A%84%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%92%8C%E7%BB%98%E5%9B%BE/article.html">基于Networkx的网络分析和绘图</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Quant/%E7%9B%AE%E5%BD%95.html">Quant</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Quant/230501-%E5%90%91%E9%87%8F%E5%8C%96%E5%9B%9E%E6%B5%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%AE%BE%E8%AE%A1/article.html">向量化回测系统的设计</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Risk/Financial_Risk_Forecasting_in_R.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Introduction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Introduction</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix-an-introduction-to-r">Appendix: An Introduction to R</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-1-financial-markets-prices-and-risk">Chapter 1: Financial Markets, Prices and Risk</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-2-univariate-volatility-modelling">Chapter 2: Univariate Volatility Modelling</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-3-multivariate-volatility-models">Chapter 3: Multivariate Volatility Models</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-4-risk-measures">Chapter 4: Risk Measures</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-5-implementing-risk-forecasts">Chapter 5: Implementing Risk Forecasts</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-6-analytical-value-at-risk-for-options-and-bonds">Chapter 6: Analytical Value-at-Risk for Options and Bonds</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-7-simulation-methods-for-var-for-options-and-bonds">Chapter 7: Simulation Methods for VaR for Options and Bonds</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-8-backtesting-and-stress-testing">Chapter 8: Backtesting and Stress Testing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-9-extreme-value-theory">Chapter 9: Extreme Value Theory</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h1>
<p>This notebook is an implementation of Jón Daníelsson’s <em>Financial Risk Forecasting</em> (Wiley, 2011) in R 4.2.0, with annotations and introductory examples. The introductory examples (Appendix) are similar to Appendix B in the original book.</p>
<p>Bullet point numbers correspond to the R/MATLAB Listing numbers in the original book, referred to henceforth as <em>FRF</em>.</p>
<p>More details can be found at the book website: https://www.financialriskforecasting.com/</p>
<p>Last updated: June 2022</p>
<p>Copyright 2011- 2020 Jón Daníelsson. This code is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This code is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. The GNU General Public License is available at: https://www.gnu.org/licenses/.</p>
<p><a id='top'></a></p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="#0"><span class="xref myst">Chapter 0. Appendix - Introduction</span></a> <br>
<a class="reference internal" href="#1"><span class="xref myst">Chapter 1. Financial Markets, Prices and Risk</span></a> <br>
<a class="reference internal" href="#2"><span class="xref myst">Chapter 2. Univariate Volatility Modeling</span></a> <br>
<a class="reference internal" href="#3"><span class="xref myst">Chapter 3. Multivariate Volatility Models</span></a> <br>
<a class="reference internal" href="#4"><span class="xref myst">Chapter 4. Risk Measures</span></a> <br>
<a class="reference internal" href="#5"><span class="xref myst">Chapter 5. Implementing Risk Forecasts</span></a> <br>
<a class="reference internal" href="#6"><span class="xref myst">Chapter 6. Analytical Value-at-Risk for Options and Bonds</span></a> <br>
<a class="reference internal" href="#7"><span class="xref myst">Chapter 7. Simulation Methods for VaR for Options and Bonds</span></a> <br>
<a class="reference internal" href="#8"><span class="xref myst">Chapter 8. Backtesting and Stress Testing</span></a> <br>
<a class="reference internal" href="#9"><span class="xref myst">Chapter 9. Extreme Value Theory</span></a> <br></p>
<p><a id='0'></a></p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="appendix-an-introduction-to-r">
<h1>Appendix: An Introduction to R<a class="headerlink" href="#appendix-an-introduction-to-r" title="Link to this heading">#</a></h1>
<p>Created in R 4.2 (June 2022)</p>
<ul class="simple">
<li><p>R.1: Entering and Printing Data</p></li>
<li><p>R.2: Vectors, Matrices and Sequences</p></li>
<li><p>R.3: Importing Data (to be updated)</p></li>
<li><p>R.4: Basic Summary Statistics</p></li>
<li><p>R.5: Calculating Moments</p></li>
<li><p>R.6: Basic Matrix Operations</p></li>
<li><p>R.7: Statistical Distributions</p></li>
<li><p>R.8: Statistical Tests</p></li>
<li><p>R.9: Time Series</p></li>
<li><p>R.10: Loops and Functions</p></li>
<li><p>R.11: Basic Graphs</p></li>
<li><p>R.12: Miscellaneous Useful Functions</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Entering and Printing Data in R</span>
<span class="c1"># Listing R.1</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="w">             </span><span class="c1"># assign x the value 10</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">           </span><span class="c1"># print x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 10
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Vectors, Matrices and Sequences in R</span>
<span class="c1"># Listing R.2</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">9</span><span class="p">)</span><span class="w">          </span><span class="c1"># create vector using c()</span>

<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="m">3</span><span class="p">])</span><span class="w">               </span><span class="c1"># calling 3rd element (R indices start at 1)</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">dim</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w">             </span><span class="c1"># gives NULL since y is a vector, not a matrix</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w">          </span><span class="c1"># as expected, y has length 5</span>

<span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="c1"># fill a 2 x 3 matrix with NaN values (default)</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">dim</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="w">             </span><span class="c1"># as expected, v is size (2,3)</span>

<span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="n">nrow</span><span class="o">=</span><span class="m">6</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="c1"># repeats matrix twice by rows, thrice by columns</span>

<span class="nf">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

<span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="w">                  </span><span class="c1"># s is a list of integers from 1 to 10 inclusive</span>

<span class="nf">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w">                  </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 1 3 5 7 9
[1] 5
NULL
[1] 5
[1] 2 3
     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    2    2    2
[3,]    3    3    3
[4,]    1    1    1
[5,]    2    2    2
[6,]    3    3    3
 [1]  1  2  3  4  5  6  7  8  9 10
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic Summary Statistics in R</span>
<span class="c1"># Listing R.3</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">y</span><span class="o">=</span><span class="nf">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">3.1</span><span class="p">,</span><span class="m">4.15</span><span class="p">,</span><span class="m">9</span><span class="p">))</span>

<span class="nf">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">         </span><span class="c1"># sum of all elements of y</span>
<span class="nf">prod</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">        </span><span class="c1"># product of all elements of y</span>
<span class="nf">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">         </span><span class="c1"># maximum value of y</span>
<span class="nf">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">         </span><span class="c1"># minimum value of y</span>
<span class="nf">range</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">       </span><span class="c1"># min, max value of y</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">        </span><span class="c1"># arithmetic mean</span>
<span class="nf">median</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">      </span><span class="c1"># median</span>
<span class="nf">var</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">         </span><span class="c1"># variance</span>
<span class="nf">cov</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">         </span><span class="c1"># covar matrix = variance for single vector</span>
<span class="nf">cor</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">         </span><span class="c1"># corr matrix = [1] for single vector</span>
<span class="nf">sort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">        </span><span class="c1"># sorting in ascending order</span>
<span class="nf">log</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">         </span><span class="c1"># natural log</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">16.25</div><div class="output text_html">115.785</div><div class="output text_html">9</div><div class="output text_html">3.1</div><div class="output text_html"><ol class=list-inline>
	<li>3.1</li>
	<li>9</li>
</ol>
</div><div class="output text_html">5.41666666666667</div><div class="output text_html">4.15</div><div class="output text_html"><table>
<tbody>
	<tr><td>9.905833</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table>
<tbody>
	<tr><td>9.905833</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table>
<tbody>
	<tr><td>1</td></tr>
</tbody>
</table>
</div><div class="output text_html"><ol class=list-inline>
	<li>3.1</li>
	<li>4.15</li>
	<li>9</li>
</ol>
</div><div class="output text_html"><table>
<tbody>
	<tr><td>1.131402</td></tr>
	<tr><td>1.423108</td></tr>
	<tr><td>2.197225</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculating Moments in R</span>
<span class="c1"># Listing R.4</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">library</span><span class="p">(</span><span class="n">moments</span><span class="p">)</span>

<span class="nf">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">      </span><span class="c1"># mean</span>
<span class="nf">var</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">       </span><span class="c1"># variance</span>
<span class="nf">sd</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">        </span><span class="c1"># unbiased standard deviation, by default</span>
<span class="nf">skewness</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">  </span><span class="c1"># skewness</span>
<span class="nf">kurtosis</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">  </span><span class="c1"># kurtosis</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">5.41666666666667</div><div class="output text_html"><table>
<tbody>
	<tr><td>9.905833</td></tr>
</tbody>
</table>
</div><div class="output text_html">3.14735338551827</div><div class="output text_html">0.61960293299089</div><div class="output text_html">1.5</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic Matrix Operations in R</span>
<span class="c1"># Listing R.5</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">   </span><span class="c1"># z is a 2 x 2 matrix</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">       </span><span class="c1"># x is a 1 x 2 matrix</span>

<span class="c1">## Note: z * x is undefined since the two matrices are not conformable</span>

<span class="n">z</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="nf">t</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">                   </span><span class="c1"># this evaluates to a 2 x 1 matrix</span>

<span class="nf">rbind</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="w">                   </span><span class="c1"># &quot;stacking&quot; z and x vertically</span>
<span class="nf">cbind</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="nf">t</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">                </span><span class="c1"># &quot;stacking z and x&#39; horizontally</span>

<span class="c1">## Note: dimensions must match along the combining axis</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<tbody>
	<tr><td> 7</td></tr>
	<tr><td>10</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table>
<tbody>
	<tr><td>1</td><td>3</td></tr>
	<tr><td>2</td><td>4</td></tr>
	<tr><td>1</td><td>2</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table>
<tbody>
	<tr><td>1</td><td>3</td><td>1</td></tr>
	<tr><td>2</td><td>4</td><td>2</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statistical Distributions in R</span>
<span class="c1"># Listing R.6</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-3</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="w">     </span><span class="c1"># specify a set of values</span>

<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w">  </span><span class="c1"># specify a set of probabilities</span>

<span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">                 </span><span class="c1"># element-wise inverse Normal quantile</span>

<span class="nf">pt</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">                              </span><span class="c1"># element-wise cdf under Student-t(4)</span>

<span class="nf">dchisq</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">                          </span><span class="c1"># element-wise pdf under Chisq(2)</span>

<span class="c1">## Similar syntax for other distributions</span>
<span class="c1">## q for quantile, p for cdf, d for pdf</span>
<span class="c1">## followed by the abbreviation of the distribution</span>

<span class="c1">## One can also obtain pseudorandom samples from distributions</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rt</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">                        </span><span class="c1"># Sampling 100 times from TDist with 5 df</span>

<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">            </span><span class="c1"># Sampling 50 times from a standard normal </span>

<span class="c1">## Given data, we obtain MLE estimates of distribution parameters with package MASS:</span>

<span class="nf">library</span><span class="p">(</span><span class="n">MASS</span><span class="p">)</span>

<span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fitdistr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">densfun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;normal&quot;</span><span class="p">)</span><span class="w">      </span><span class="c1"># Fitting x to normal dist</span>

<span class="nf">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><ol class=list-inline>
	<li>-1.2815515655446</li>
	<li>-0.841621233572914</li>
	<li>-0.524400512708041</li>
	<li>-0.2533471031358</li>
	<li>0</li>
	<li>0.2533471031358</li>
	<li>0.524400512708041</li>
	<li>0.841621233572914</li>
	<li>1.2815515655446</li>
</ol>
</div><div class="output text_html"><ol class=list-inline>
	<li>0.0199709840358594</li>
	<li>0.0580582617584078</li>
	<li>0.186950483150029</li>
	<li>0.5</li>
	<li>0.813049516849971</li>
	<li>0.941941738241592</li>
	<li>0.980029015964141</li>
</ol>
</div><div class="output text_html"><ol class=list-inline>
	<li>0</li>
	<li>0</li>
	<li>0</li>
	<li>0.5</li>
	<li>0.303265329856317</li>
	<li>0.183939720585721</li>
	<li>0.111565080074215</li>
</ol>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      mean          sd    
  0.09037338   1.46351265 
 (0.14635126) (0.10348597)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statistical Tests in R</span>
<span class="c1"># Listing R.7</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">library</span><span class="p">(</span><span class="n">tseries</span><span class="p">)</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rt</span><span class="p">(</span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">                            </span><span class="c1"># Create hypothetical dataset x</span>

<span class="nf">jarque.bera.test</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">                            </span><span class="c1"># Jarque-Bera test for normality</span>
<span class="nf">Box.test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">lag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Ljung-Box&quot;</span><span class="p">))</span><span class="w">   </span><span class="c1"># Ljung-Box test for serial correlation</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
&quot;package &#39;tseries&#39; was built under R version 3.6.3&quot;Registered S3 method overwritten by &#39;xts&#39;:
  method     from
  as.zoo.xts zoo 
Registered S3 method overwritten by &#39;quantmod&#39;:
  method            from
  as.zoo.data.frame zoo 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	Jarque Bera Test

data:  x
X-squared = 181.87, df = 2, p-value &lt; 2.2e-16
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	Box-Ljung test

data:  x
X-squared = 16.067, df = 20, p-value = 0.7125
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time Series in R</span>
<span class="c1"># Listing R.8</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rt</span><span class="p">(</span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">  </span><span class="c1"># Create hypothetical dataset x</span>

<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">pty</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">)</span>

<span class="nf">acf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="m">20</span><span class="p">)</span><span class="w">           </span><span class="c1"># autocorrelation for lags 1:20</span>
<span class="nf">pacf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="m">20</span><span class="p">)</span><span class="w">          </span><span class="c1"># partial autocorrelation for lags 1:20</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f09f15d4737f52eaba0f723b77d31cdd60cad26a7b585b76abc86213999748db.png" src="../_images/f09f15d4737f52eaba0f723b77d31cdd60cad26a7b585b76abc86213999748db.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loops and Functions in R</span>
<span class="c1"># Listing R.9</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="c1">## For loops</span>

<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">7</span><span class="p">)</span><span class="w">        </span><span class="c1"># iterates through [3,4,5,6,7]</span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="n">i</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">      </span>

<span class="c1">## If-else loops</span>

<span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>

<span class="nf">if </span><span class="p">(</span><span class="n">X</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;X is a multiple of 3&quot;</span><span class="p">)</span>
<span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;X is not a multiple of 3&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="w">    </span>
<span class="c1">## Functions (example: a simple excess kurtosis function)</span>

<span class="n">excess_kurtosis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">excess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">){</span><span class="w"> </span><span class="c1"># note: excess optional, default=3</span>
<span class="w">    </span><span class="n">m4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">^</span><span class="m">4</span><span class="p">)</span>
<span class="w">    </span><span class="n">excess_kurt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m4</span><span class="o">/</span><span class="p">(</span><span class="nf">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">^</span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">excess</span>
<span class="w">    </span><span class="n">excess_kurt</span>
<span class="p">}</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rt</span><span class="p">(</span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">                         </span><span class="c1"># Create hypothetical dataset x</span>

<span class="nf">excess_kurtosis</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">      </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 9
[1] 16
[1] 25
[1] 36
[1] 49
[1] &quot;X is not a multiple of 3&quot;
</pre></div>
</div>
<div class="output text_html">2.84966889440353</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic Graphs in R</span>
<span class="c1"># Listing R.10</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>

<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="c1"># sets up space for subplots</span>

<span class="nf">barplot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">        </span><span class="c1"># bar plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">)</span><span class="w">  </span><span class="c1"># line plot</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">           </span><span class="c1"># histogram</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">           </span><span class="c1"># scatter plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/41b6b669fa29f1a3929545913df3d27cfa23069aed15a8dfb33f2bdec19d9d0f.png" src="../_images/41b6b669fa29f1a3929545913df3d27cfa23069aed15a8dfb33f2bdec19d9d0f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Miscellaneous Useful Functions in R</span>
<span class="c1"># Listing R.11</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="c1">## Convert objects from one type to another with as.integer() etc</span>
<span class="c1">## To check type, use typeof(object)</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8.0</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">typeof</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] &quot;double&quot;
[1] &quot;integer&quot;
</pre></div>
</div>
</div>
</div>
<p><a id='1'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-1-financial-markets-prices-and-risk">
<h1>Chapter 1: Financial Markets, Prices and Risk<a class="headerlink" href="#chapter-1-financial-markets-prices-and-risk" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>1.1: Loading hypothetical stock prices, converting to returns, plotting returns</p></li>
<li><p>1.3: Summary statistics for returns timeseries</p></li>
<li><p>1.5: Autocorrelation function (ACF) plots, Ljung-Box test</p></li>
<li><p>1.7: Quantile-Quantile (QQ) plots</p></li>
<li><p>1.9: Correlation matrix between different stocks</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download S&amp;P500 data in R</span>
<span class="c1"># Listing 1.1</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="w"> </span>
<span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;index.csv&#39;</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span><span class="nf">diff</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">price</span><span class="o">$</span><span class="n">Index</span><span class="p">))</span><span class="w">  </span><span class="c1"># calculate returns</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">             </span><span class="c1"># plot returns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b94ba48981650440eb49f1740c0c5d39fa46d99eb8da1cf7e95b9bcd6a52c55f.png" src="../_images/b94ba48981650440eb49f1740c0c5d39fa46d99eb8da1cf7e95b9bcd6a52c55f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample statistics in R</span>
<span class="c1"># Listing 1.3</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">library</span><span class="p">(</span><span class="n">moments</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tseries</span><span class="p">)</span>

<span class="nf">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nf">sd</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nf">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nf">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nf">skewness</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nf">kurtosis</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nf">jarque.bera.test</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0.000258159900825998</div><div class="output text_html">0.0100057286437631</div><div class="output text_html">-0.101955486273023</div><div class="output text_html">0.106735895029117</div><div class="output text_html">0.152633269896337</div><div class="output text_html">16.981171461092</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	Jarque Bera Test

data:  y
X-squared = 46251, df = 2, p-value &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># ACF plots and the Ljung-Box test in R</span>
<span class="c1"># Listing 1.5</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">library</span><span class="p">(</span><span class="n">MASS</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>

<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">pty</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">)</span>
<span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">acf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="m">20</span><span class="p">)</span>
<span class="n">q1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">acf</span><span class="p">(</span><span class="n">y</span><span class="o">^</span><span class="m">2</span><span class="p">,</span><span class="m">20</span><span class="p">)</span>

<span class="nf">Box.test</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">lag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Ljung-Box&quot;</span><span class="p">))</span>
<span class="nf">Box.test</span><span class="p">(</span><span class="n">y</span><span class="o">^</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Ljung-Box&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	Box-Ljung test

data:  y
X-squared = 93.488, df = 20, p-value = 1.809e-11
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	Box-Ljung test

data:  y^2
X-squared = 2543, df = 20, p-value &lt; 2.2e-16
</pre></div>
</div>
<img alt="../_images/c5e620c9c09e402c8c087a721250782de37bcd8e918502a82366307e18d03d37.png" src="../_images/c5e620c9c09e402c8c087a721250782de37bcd8e918502a82366307e18d03d37.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># QQ plots in R</span>
<span class="c1"># Listing 1.7</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>

<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">pty</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">)</span>

<span class="nf">qqPlot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nf">qqPlot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">distribution</span><span class="o">=</span><span class="s">&quot;t&quot;</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="m">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading required package: carData
</pre></div>
</div>
<div class="output text_html"><ol class=list-inline>
	<li>3192</li>
	<li>3101</li>
</ol>
</div><div class="output text_html"><ol class=list-inline>
	<li>3192</li>
	<li>3101</li>
</ol>
</div><img alt="../_images/4c853cacdd426c611d91f4c11585d4dc5867ec17cfc1e24419671137bd05c0d0.png" src="../_images/4c853cacdd426c611d91f4c11585d4dc5867ec17cfc1e24419671137bd05c0d0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download stock prices in R</span>
<span class="c1"># Listing 1.9</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;stocks.csv&#39;</span><span class="p">)</span>

<span class="n">y</span><span class="o">=</span><span class="nf">apply</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="m">2</span><span class="p">,</span><span class="n">diff</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">cor</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="c1"># correlation matrix</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          A         B         C
A 1.0000000 0.2296842 0.2126192
B 0.2296842 1.0000000 0.1450511
C 0.2126192 0.1450511 1.0000000
</pre></div>
</div>
</div>
</div>
<p><a id='2'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-2-univariate-volatility-modelling">
<h1>Chapter 2: Univariate Volatility Modelling<a class="headerlink" href="#chapter-2-univariate-volatility-modelling" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>2.1: GARCH and t-GARCH estimation</p></li>
<li><p>2.3: APARCH estimation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># ARCH and GARCH estimation in R</span>
<span class="c1"># Listing 2.1</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">library</span><span class="p">(</span><span class="n">rugarch</span><span class="p">)</span>

<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;index.csv&#39;</span><span class="p">)</span>

<span class="c1">## We multiply returns by 100 and de-mean them</span>
<span class="n">y</span><span class="o">=</span><span class="nf">diff</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">p</span><span class="o">$</span><span class="n">Index</span><span class="p">))</span><span class="o">*</span><span class="m">100</span>
<span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1">## GARCH(1,1)</span>
<span class="n">spec1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchspec</span><span class="p">(</span><span class="n">variance.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">garchOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span>
<span class="w"> </span><span class="n">mean.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">armaOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="n">include.mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span>
<span class="n">res1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchfit</span><span class="p">(</span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>

<span class="c1">## ARCH(1)</span>
<span class="n">spec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchspec</span><span class="p">(</span><span class="n">variance.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">garchOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w"> </span><span class="n">mean.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">armaOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="n">include.mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span>
<span class="n">res2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchfit</span><span class="p">(</span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec2</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>

<span class="c1">## tGARCH(1,1)</span>
<span class="n">spec3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchspec</span><span class="p">(</span><span class="n">variance.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">garchOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span>
<span class="w"> </span><span class="n">mean.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">armaOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="n">include.mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">),</span><span class="w"> </span>
<span class="w"> </span><span class="n">distribution.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;std&quot;</span><span class="p">)</span>
<span class="n">res3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchfit</span><span class="p">(</span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec3</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>

<span class="c1">## plot(res) shows various graphical analysis, works in command line</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Your code contains a unicode char which cannot be displayed in your
current locale and R will silently convert it to an escaped form when the
R kernel executes this code. This can lead to subtle errors if you use
such chars to do comparisons. For more information, please see
https://github.com/IRkernel/repr/wiki/Problems-with-unicode-on-windowsWarning message:
&quot;package &#39;rugarch&#39; was built under R version 3.6.3&quot;Loading required package: parallel

Attaching package: &#39;rugarch&#39;

The following object is masked from &#39;package:stats&#39;:

    sigma
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Advanced ARCH and GARCH estimation in R</span>
<span class="c1"># Listing 2.3</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="c1">## Normal APARCH(1,1)</span>
<span class="n">spec4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchspec</span><span class="p">(</span><span class="n">variance.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">&quot;apARCH&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">garchOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span>
<span class="w"> </span><span class="n">mean.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">armaOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="n">include.mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span>
<span class="n">res4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchfit</span><span class="p">(</span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec4</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="c1">## show(res4)</span>

<span class="c1">## Normal APARCH(1,1) with fixed delta</span>
<span class="n">spec5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchspec</span><span class="p">(</span><span class="n">variance.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">&quot;apARCH&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">garchOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span>
<span class="w"> </span><span class="n">mean.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">armaOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="n">include.mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">),</span><span class="w"> </span><span class="n">fixed.pars</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">delta</span><span class="o">=</span><span class="m">2</span><span class="p">))</span>
<span class="n">res5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchfit</span><span class="p">(</span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec5</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="nf">show</span><span class="p">(</span><span class="n">res5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>*---------------------------------*
*          GARCH Model Fit        *
*---------------------------------*

Conditional Variance Dynamics 	
-----------------------------------
GARCH Model	: apARCH(1,1)
Mean Model	: ARFIMA(0,0,0)
Distribution	: norm 

Optimal Parameters
------------------------------------
        Estimate  Std. Error   t value Pr(&gt;|t|)
omega   0.013024    0.001742   7.47834  0.00000
alpha1  0.068106    0.005309  12.82897  0.00000
beta1   0.918173    0.005618 163.42362  0.00000
gamma1  0.009355    0.031721   0.29493  0.76805
delta   2.000000          NA        NA       NA

Robust Standard Errors:
        Estimate  Std. Error  t value Pr(&gt;|t|)
omega   0.013024    0.003600  3.61723 0.000298
alpha1  0.068106    0.009486  7.17951 0.000000
beta1   0.918173    0.012216 75.16401 0.000000
gamma1  0.009355    0.060855  0.15373 0.877823
delta   2.000000          NA       NA       NA

LogLikelihood : -6970.28 

Information Criteria
------------------------------------
                   
Akaike       2.4575
Bayes        2.4621
Shibata      2.4575
Hannan-Quinn 2.4591

Weighted Ljung-Box Test on Standardized Residuals
------------------------------------
                        statistic p-value
Lag[1]                      3.616 0.05722
Lag[2*(p+q)+(p+q)-1][2]     3.857 0.08240
Lag[4*(p+q)+(p+q)-1][5]     4.221 0.22779
d.o.f=0
H0 : No serial correlation

Weighted Ljung-Box Test on Standardized Squared Residuals
------------------------------------
                        statistic p-value
Lag[1]                     0.4164  0.5188
Lag[2*(p+q)+(p+q)-1][5]    3.3472  0.3473
Lag[4*(p+q)+(p+q)-1][9]    4.2909  0.5403
d.o.f=2

Weighted ARCH LM Tests
------------------------------------
            Statistic Shape Scale P-Value
ARCH Lag[3]    0.5263 0.500 2.000  0.4682
ARCH Lag[5]    0.5995 1.440 1.667  0.8539
ARCH Lag[7]    0.9614 2.315 1.543  0.9198

Nyblom stability test
------------------------------------
Joint Statistic:  0.5702
Individual Statistics:              
omega  0.12447
alpha1 0.22152
beta1  0.14319
gamma1 0.08482

Asymptotic Critical Values (10% 5% 1%)
Joint Statistic:     	 1.07 1.24 1.6
Individual Statistic:	 0.35 0.47 0.75

Sign Bias Test
------------------------------------
                   t-value   prob sig
Sign Bias           1.1061 0.2687    
Negative Sign Bias  0.2245 0.8224    
Positive Sign Bias  0.0615 0.9510    
Joint Effect        1.6625 0.6453    


Adjusted Pearson Goodness-of-Fit Test:
------------------------------------
  group statistic p-value(g-1)
1    20     308.5    3.656e-54
2    30     353.5    1.753e-57
3    40     381.3    9.740e-58
4    50     393.5    2.611e-55


Elapsed time : 0.1839082 
</pre></div>
</div>
</div>
</div>
<p><a id='3'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-3-multivariate-volatility-models">
<h1>Chapter 3: Multivariate Volatility Models<a class="headerlink" href="#chapter-3-multivariate-volatility-models" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>3.1: Loading hypothetical stock prices</p></li>
<li><p>3.3: EWMA estimation</p></li>
<li><p>3.5: OGARCH estimation</p></li>
<li><p>3.7: DCC estimation</p></li>
<li><p>3.9: Comparison of EWMA, OGARCH, DCC</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download stock prices in R</span>
<span class="c1"># Listing 3.1</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;stocks.csv&#39;</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span><span class="nf">apply</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="m">2</span><span class="p">,</span><span class="n">diff</span><span class="p">)</span><span class="w">     </span><span class="c1"># calculate returns</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]</span><span class="w">                </span><span class="c1"># consider first two stocks</span>
<span class="n">y</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">  </span><span class="c1"># subtract mean</span>
<span class="n">y</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span>
<span class="n">TT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># EWMA in R</span>
<span class="c1"># Listing 3.3</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="c1">## create a matrix to hold covariance matrix for each t</span>
<span class="n">EWMA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="n">TT</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">   </span>
<span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.94</span>
<span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cov</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">                      </span><span class="c1"># initial (t=1) covar matrix</span>
<span class="n">EWMA</span><span class="p">[</span><span class="m">1</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">S</span><span class="p">)[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">)]</span><span class="w">       </span><span class="c1"># extract var and covar</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="m">1</span><span class="p">]){</span><span class="w">  </span>
<span class="w">      </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="o">*</span><span class="n">S</span><span class="o">+</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">lambda</span><span class="p">)</span><span class="o">*</span><span class="w">  </span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">,]</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="nf">t</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">,])</span>
<span class="w">      </span><span class="n">EWMA</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">S</span><span class="p">)[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">)]</span><span class="w"> </span>
<span class="p">}</span>
<span class="n">EWMArho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EWMA</span><span class="p">[,</span><span class="m">3</span><span class="p">]</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">EWMA</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="o">*</span><span class="n">EWMA</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="c1"># calculate correlations</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">EWMArho</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">tail</span><span class="p">(</span><span class="n">EWMArho</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 0.2296842 0.2236347 0.2218277 0.2270681 0.2054204 0.1992979
[1] 0.1931994 0.1914987 0.2177147 0.3436632 0.3122741 0.3159703
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># GOGARCH in R</span>
<span class="c1"># Listing 3.5</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">library</span><span class="p">(</span><span class="n">rmgarch</span><span class="p">)</span>
<span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">gogarchspec</span><span class="p">(</span><span class="n">mean.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">armaOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span>
<span class="w">    </span><span class="n">include.mean</span><span class="w"> </span><span class="o">=</span><span class="kc">FALSE</span><span class="p">),</span>
<span class="w">    </span><span class="n">variance.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sGARCH&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">garchOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">distribution.model</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">&quot;mvnorm&quot;</span>
<span class="p">)</span>
<span class="n">fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">gogarchfit</span><span class="p">(</span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>

<span class="nf">show</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="w"> </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
&quot;package &#39;rmgarch&#39; was built under R version 3.6.3&quot;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>*------------------------------*
*        GO-GARCH Fit          *
*------------------------------*

Mean Model		: CONSTANT
GARCH Model		: sGARCH
Distribution	: mvnorm
ICA Method		: fastica
No. Factors		: 2
No. Periods		: 5676
Log-Likelihood	: 40378.57
------------------------------------

U (rotation matrix) : 

       [,1]  [,2]
[1,] -0.358 0.934
[2,]  0.934 0.358

A (mixing matrix) : 

         [,1]     [,2]
[1,] -0.00642 0.000213
[2,] -0.00187 0.009296
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># DCC in R</span>
<span class="c1"># Listing 3.7</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="n">xspec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchspec</span><span class="p">(</span><span class="n">mean.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">armaOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">include.mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span>

<span class="n">uspec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">multispec</span><span class="p">(</span><span class="nf">replicate</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">xspec</span><span class="p">))</span>

<span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dccspec</span><span class="p">(</span><span class="n">uspec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uspec</span><span class="p">,</span><span class="w"> </span><span class="n">dccOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">distribution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;mvnorm&#39;</span><span class="p">)</span>

<span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dccfit</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>

<span class="n">H</span><span class="o">=</span><span class="n">res</span><span class="o">@</span><span class="n">mfit</span><span class="o">$</span><span class="n">H</span>

<span class="n">DCCrho</span><span class="o">=</span><span class="nf">vector</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="nf">dim</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span>

<span class="nf">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="m">1</span><span class="p">]){</span>
<span class="w">    </span><span class="n">DCCrho</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">H</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="n">i</span><span class="p">])</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample statistics in R</span>
<span class="c1"># Listing 3.9</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">matplot</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">EWMArho</span><span class="p">,</span><span class="n">DCCrho</span><span class="p">),</span><span class="n">type</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span><span class="n">las</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">mtext</span><span class="p">(</span><span class="s">&quot;Correlations&quot;</span><span class="p">,</span><span class="n">side</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">line</span><span class="o">=</span><span class="m">0.3</span><span class="p">,</span><span class="n">at</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">las</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
<span class="nf">legend</span><span class="p">(</span><span class="s">&quot;bottomright&quot;</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;EWMA&quot;</span><span class="p">,</span><span class="s">&quot;DCC&quot;</span><span class="p">),</span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="n">bty</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9151580bbb1fd98ab49b01e52d59d40bc336cbaef2a54e86db03a9e1323a0447.png" src="../_images/9151580bbb1fd98ab49b01e52d59d40bc336cbaef2a54e86db03a9e1323a0447.png" />
</div>
</div>
<p><a id='4'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-4-risk-measures">
<h1>Chapter 4: Risk Measures<a class="headerlink" href="#chapter-4-risk-measures" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>4.1: Expected Shortfall (ES) estimation under normality assumption</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># ES in R</span>
<span class="c1"># Listing 4.1</span>
<span class="c1"># Last updated August 2016</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.1</span><span class="p">,</span><span class="m">0.05</span><span class="p">,</span><span class="m">0.025</span><span class="p">,</span><span class="m">0.01</span><span class="p">,</span><span class="m">0.001</span><span class="p">)</span>
<span class="n">VaR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">ES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="n">p</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;Probabilities:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="s">&quot;%&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="s">&quot;VaR:&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">VaR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="s">&quot;ES:&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Probabilities: 50% 10% 5% 2.5% 1% 0.1% 
 VaR: 0 1.281552 1.644854 1.959964 2.326348 3.090232 
 ES: 0.7978846 1.754983 2.062713 2.337803 2.665214 3.36709
</pre></div>
</div>
</div>
</div>
<p><a id='5'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-5-implementing-risk-forecasts">
<h1>Chapter 5: Implementing Risk Forecasts<a class="headerlink" href="#chapter-5-implementing-risk-forecasts" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>5.1: Loading hypothetical stock prices, converting to returns</p></li>
<li><p>5.3: Univariate HS Value at Risk (VaR)</p></li>
<li><p>5.5: Multivariate HS VaR</p></li>
<li><p>5.7: Univariate ES VaR</p></li>
<li><p>5.9: Normal VaR</p></li>
<li><p>5.11: Portfolio Normal VaR</p></li>
<li><p>5.13: Student-t VaR</p></li>
<li><p>5.15: Normal ES VaR</p></li>
<li><p>5.17: Direct Integration Normal ES VaR</p></li>
<li><p>5.19: MA Normal VaR</p></li>
<li><p>5.21: EWMA VaR</p></li>
<li><p>5.23: Two-asset EWMA VaR</p></li>
<li><p>5.25: GARCH(1,1) VaR</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download stock prices in R</span>
<span class="c1"># Listing 5.1</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;stocks.csv&#39;</span><span class="p">)</span>

<span class="c1">## Calculate returns. Note that first column is dates</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="m">2</span><span class="p">,</span><span class="n">diff</span><span class="p">)</span>

<span class="c1">## Specify portfolio value and VaR probability</span>
<span class="n">portfolio_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Univariate HS in R</span>
<span class="c1"># Listing 5.3</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w">                     </span><span class="c1"># select one asset</span>
<span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="w">                  </span><span class="c1"># sort returns</span>
<span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ceiling</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="w">     </span><span class="c1"># p percent smallest, rounded up</span>
<span class="n">VaR1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ys</span><span class="p">[</span><span class="n">op</span><span class="p">]</span><span class="o">*</span><span class="n">portfolio_value</span>
<span class="nf">print</span><span class="p">(</span><span class="n">VaR1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 17.49822
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multivariate HS in R</span>
<span class="c1"># Listing 5.5</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.3</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.5</span><span class="p">))</span><span class="w">   </span><span class="c1"># vector of portfolio weights</span>

<span class="c1">## The number of columns of the left matrix must be the same as the number of rows of the right matrix </span>

<span class="n">yp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">w</span><span class="w">                 </span><span class="c1"># obtain portfolio returns</span>
<span class="n">yps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">yp</span><span class="p">)</span>
<span class="n">VaR2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">yps</span><span class="p">[</span><span class="n">op</span><span class="p">]</span><span class="o">*</span><span class="n">portfolio_value</span>
<span class="nf">print</span><span class="p">(</span><span class="n">VaR2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 14.20901
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Univariate ES in R</span>
<span class="c1"># Listing 5.7</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">ES1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">op</span><span class="p">])</span><span class="o">*</span><span class="n">portfolio_value</span>

<span class="nf">print</span><span class="p">(</span><span class="n">ES1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 22.56339
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal VaR in R</span>
<span class="c1"># Listing 5.9</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="w"> </span><span class="c1"># estimate volatility</span>
<span class="n">VaR3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sigma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span>

<span class="nf">print</span><span class="p">(</span><span class="n">VaR3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 14.94957
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Portfolio normal VaR in R</span>
<span class="c1"># Listing 5.11</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="nf">cov</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">w</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># portfolio volatility</span>
<span class="c1">## Note: the trailing [1] is to convert a single element matrix to float</span>

<span class="n">VaR4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sigma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">portfolio_value</span>

<span class="nf">print</span><span class="p">(</span><span class="n">VaR4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 12.27959
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Student-t VaR in R</span>
<span class="c1"># Listing 5.13</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">library</span><span class="p">(</span><span class="n">QRM</span><span class="p">)</span>

<span class="n">scy1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="m">100</span><span class="w">                     </span><span class="c1"># scale the returns </span>
<span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fit.st</span><span class="p">(</span><span class="n">scy1</span><span class="p">)</span><span class="w"> </span>
<span class="n">sigma1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unname</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">par.ests</span><span class="p">[</span><span class="s">&#39;sigma&#39;</span><span class="p">]</span><span class="o">/</span><span class="m">100</span><span class="p">)</span><span class="w">  </span><span class="c1"># rescale the volatility</span>
<span class="n">nu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unname</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">par.ests</span><span class="p">[</span><span class="s">&#39;nu&#39;</span><span class="p">])</span>
<span class="c1">## Note: We are removing the names of the fit.st output using unname()</span>

<span class="n">VaR5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sigma1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">qt</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">nu</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">portfolio_value</span>

<span class="nf">print</span><span class="p">(</span><span class="n">VaR5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
&quot;package &#39;QRM&#39; was built under R version 3.6.3&quot;Loading required package: gsl
Loading required package: Matrix
Loading required package: mvtnorm
Warning message:
&quot;package &#39;mvtnorm&#39; was built under R version 3.6.3&quot;Loading required package: numDeriv
Loading required package: timeSeries
Warning message:
&quot;package &#39;timeSeries&#39; was built under R version 3.6.3&quot;Loading required package: timeDate

Attaching package: &#39;timeDate&#39;

The following objects are masked from &#39;package:moments&#39;:

    kurtosis, skewness


Attaching package: &#39;QRM&#39;

The following object is masked from &#39;package:base&#39;:

    lbeta
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 17.12558
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal ES in R</span>
<span class="c1"># Listing 5.15</span>
<span class="c1"># Last updated June August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">ES2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma</span><span class="o">*</span><span class="nf">dnorm</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="n">p</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span>

<span class="nf">print</span><span class="p">(</span><span class="n">ES2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 17.12719
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Direct integration ES in R</span>
<span class="c1"># Listing 5.17</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">VaR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">integrand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">q</span><span class="p">){</span><span class="n">q</span><span class="o">*</span><span class="nf">dnorm</span><span class="p">(</span><span class="n">q</span><span class="p">)}</span>
<span class="n">ES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sigma</span><span class="o">*</span><span class="nf">integrate</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span><span class="o">-</span><span class="n">VaR</span><span class="p">)</span><span class="o">$</span><span class="n">value</span><span class="o">/</span><span class="n">p</span><span class="o">*</span><span class="n">portfolio_value</span>

<span class="nf">print</span><span class="p">(</span><span class="n">ES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 17.12719
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># MA normal VaR in R</span>
<span class="c1"># Listing 5.19</span>
<span class="c1"># Last updated June August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">WE</span><span class="o">=</span><span class="m">20</span>
<span class="nf">for </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="m">-5</span><span class="p">,</span><span class="nf">length</span><span class="p">(</span><span class="n">y1</span><span class="p">))){</span>
<span class="w">  </span><span class="n">t1</span><span class="o">=</span><span class="n">t</span><span class="o">-</span><span class="n">WE</span><span class="m">+1</span>
<span class="w">  </span><span class="n">window</span><span class="o">=</span><span class="w"> </span><span class="n">y1</span><span class="p">[</span><span class="n">t1</span><span class="o">:</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="c1"># estimation window</span>
<span class="w">  </span><span class="n">sigma</span><span class="o">=</span><span class="nf">sd</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="w">  </span><span class="n">VaR6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sigma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span>
<span class="w">  </span><span class="nf">print</span><span class="p">(</span><span class="n">VaR6</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 16.0505
[1] 16.1491
[1] 18.85435
[1] 18.88212
[1] 16.23053
[1] 16.16976
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># EWMA VaR in R</span>
<span class="c1"># Listing 5.21</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.94</span>
<span class="n">s11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="w">             </span><span class="c1"># initial variance, using unconditional</span>
<span class="nf">for </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y1</span><span class="p">)){</span><span class="w"> </span>
<span class="w">  </span><span class="n">s11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">s11</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">lambda</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y1</span><span class="p">[</span><span class="n">t</span><span class="m">-1</span><span class="p">]</span><span class="o">^</span><span class="m">2</span>
<span class="p">}</span>
<span class="n">VaR7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span>

<span class="nf">print</span><span class="p">(</span><span class="n">VaR7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 16.75344
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Three-asset EWMA VaR in R</span>
<span class="c1"># Listing 5.23</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cov</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">                        </span><span class="c1"># initial covariance</span>
<span class="nf">for </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="m">1</span><span class="p">]){</span>
<span class="w">  </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="o">*</span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">lambda</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="m">-1</span><span class="p">,]</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="nf">t</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="m">-1</span><span class="p">,])</span>
<span class="p">}</span>
<span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">w</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># portfolio vol</span>
<span class="c1">## Note: trailing[1] is to convert single element matrix to float</span>

<span class="n">VaR8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sigma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span>

<span class="nf">print</span><span class="p">(</span><span class="n">VaR8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 11.50952
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Univariate GARCH in R</span>
<span class="c1"># Listing 5.25</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="nf">library</span><span class="p">(</span><span class="n">rugarch</span><span class="p">)</span>

<span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchspec</span><span class="p">(</span><span class="n">variance.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">garchOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span>
<span class="w">                  </span><span class="n">mean.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">armaOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="n">include.mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span>
<span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchfit</span><span class="p">(</span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y1</span><span class="p">)</span>

<span class="n">omega</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">@</span><span class="n">fit</span><span class="o">$</span><span class="n">coef</span><span class="p">[</span><span class="s">&#39;omega&#39;</span><span class="p">]</span>
<span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">@</span><span class="n">fit</span><span class="o">$</span><span class="n">coef</span><span class="p">[</span><span class="s">&#39;alpha1&#39;</span><span class="p">]</span>
<span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">@</span><span class="n">fit</span><span class="o">$</span><span class="n">coef</span><span class="p">[</span><span class="s">&#39;beta1&#39;</span><span class="p">]</span>
<span class="n">sigma2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">omega</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">tail</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">tail</span><span class="p">(</span><span class="n">res</span><span class="o">@</span><span class="n">fit</span><span class="o">$</span><span class="n">var</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">  </span>
<span class="n">VaR9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">sigma2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span><span class="w"> </span>
<span class="nf">names</span><span class="p">(</span><span class="n">VaR9</span><span class="p">)</span><span class="o">=</span><span class="s">&quot;VaR&quot;</span>
<span class="nf">print</span><span class="p">(</span><span class="n">VaR9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     VaR 
16.87364 
</pre></div>
</div>
</div>
</div>
<p><a id='6'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-6-analytical-value-at-risk-for-options-and-bonds">
<h1>Chapter 6: Analytical Value-at-Risk for Options and Bonds<a class="headerlink" href="#chapter-6-analytical-value-at-risk-for-options-and-bonds" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>6.1: Black-Scholes function definition</p></li>
<li><p>6.3: Black-Scholes option price calculation example</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Black-Scholes function in R</span>
<span class="c1"># Listing 6.1</span>
<span class="c1"># Last updated 2011</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">bs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="bp">T</span><span class="p">){</span>
<span class="w">	</span><span class="n">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">P</span><span class="o">/</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.5</span><span class="o">*</span><span class="n">sigma</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">T</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="bp">T</span><span class="p">))</span>
<span class="w">	</span><span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sigma</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="bp">T</span><span class="p">)</span>

<span class="w">	</span><span class="n">Call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="o">*</span><span class="nf">pnorm</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">mean</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">-</span><span class="n">X</span><span class="o">*</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="bp">T</span><span class="p">))</span><span class="o">*</span><span class="nf">pnorm</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="n">mean</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="w">	</span><span class="n">Put</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="o">*</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="bp">T</span><span class="p">))</span><span class="o">*</span><span class="nf">pnorm</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">,</span><span class="n">mean</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">-</span><span class="n">P</span><span class="o">*</span><span class="nf">pnorm</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">,</span><span class="n">mean</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>

<span class="w">	</span><span class="n">Delta.Call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">pnorm</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span>
<span class="w">	</span><span class="n">Delta.Put</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Delta.Call</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span>
<span class="w">	</span><span class="n">Gamma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">sigma</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="bp">T</span><span class="p">))</span>

<span class="w">	</span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">Call</span><span class="o">=</span><span class="n">Call</span><span class="p">,</span><span class="n">Put</span><span class="o">=</span><span class="n">Put</span><span class="p">,</span><span class="n">Delta.Call</span><span class="o">=</span><span class="n">Delta.Call</span><span class="p">,</span><span class="n">Delta.Put</span><span class="o">=</span><span class="n">Delta.Put</span><span class="p">,</span><span class="n">Gamma</span><span class="o">=</span><span class="n">Gamma</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Black-Scholes in R</span>
<span class="c1"># Listing 6.3</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="bp">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>$Call
[1] 13.49852

$Put
[1] 1.27641

$Delta.Call
[1] 0.8395228

$Delta.Put
[1] -0.1604772

$Gamma
[1] 0.01723826
</pre></div>
</div>
</div>
</div>
<p><a id='7'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-7-simulation-methods-for-var-for-options-and-bonds">
<h1>Chapter 7: Simulation Methods for VaR for Options and Bonds<a class="headerlink" href="#chapter-7-simulation-methods-for-var-for-options-and-bonds" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>7.1: Plotting normal distribution transformation</p></li>
<li><p>7.3: Random number generation from Uniform(0,1), Normal(0,1)</p></li>
<li><p>7.5: Bond pricing using yield curve</p></li>
<li><p>7.7: Yield curve simulations</p></li>
<li><p>7.9: Bond price simulations</p></li>
<li><p>7.11: Black-Scholes analytical pricing of call</p></li>
<li><p>7.13: Black-Scholes Monte Carlo simulation pricing of call</p></li>
<li><p>7.15: Option density plots</p></li>
<li><p>7.17: VaR simulation of portfolio with only underlying</p></li>
<li><p>7.19: VaR simulation of portfolio with only call</p></li>
<li><p>7.21: VaR simulation of portfolio with call, put and underlying</p></li>
<li><p>7.23: Simulated two-asset returns</p></li>
<li><p>7.25: Two-asset portfolio VaR</p></li>
<li><p>7.27: Two-asset portfolio VaR with a call</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Transformation in R</span>
<span class="c1"># Listing 7.1</span>
<span class="c1"># Last updated 2011</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">pnorm</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;l&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f94c4837e62538f726d3a6d2fc640bb9340ed1dde6ef100a08b6ee824234b1d5.png" src="../_images/f94c4837e62538f726d3a6d2fc640bb9340ed1dde6ef100a08b6ee824234b1d5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Various RNs in R</span>
<span class="c1"># Listing 7.3</span>
<span class="c1"># Last updated 2011</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="c1"># set seed</span>

<span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>
<span class="nf">runif</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="nf">rnorm</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="nf">rt</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="m">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><ol class=list-inline>
	<li>0.0693609158042818</li>
	<li>0.817775198724121</li>
	<li>0.942621732363477</li>
	<li>0.269381876336411</li>
	<li>0.169348123250529</li>
	<li>0.0338956224732101</li>
	<li>0.178785004187375</li>
	<li>0.641665365546942</li>
	<li>0.0228777434676886</li>
	<li>0.00832482660189271</li>
</ol>
</div><div class="output text_html"><ol class=list-inline>
	<li>-0.27229604424923</li>
	<li>-0.315348711467784</li>
	<li>-0.628255236517538</li>
	<li>-0.106463884872094</li>
	<li>0.428014802202354</li>
	<li>-0.777719582147445</li>
	<li>-1.29388229761362</li>
	<li>-0.779566508059429</li>
	<li>0.0119517585652984</li>
	<li>-0.152416237822168</li>
</ol>
</div><div class="output text_html"><ol class=list-inline>
	<li>-0.54686521181825</li>
	<li>0.325766227984669</li>
	<li>-0.310344756918247</li>
	<li>1.64011963529838</li>
	<li>-0.60065788608405</li>
	<li>-0.504397302337928</li>
	<li>0.146674867812759</li>
	<li>0.421606955584244</li>
	<li>-1.10969020069546</li>
	<li>0.674102188748512</li>
</ol>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Price bond in R</span>
<span class="c1"># Listing 7.5</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">yield</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5.00</span><span class="p">,</span><span class="w"> </span><span class="m">5.69</span><span class="p">,</span><span class="w"> </span><span class="m">6.09</span><span class="p">,</span><span class="w"> </span><span class="m">6.38</span><span class="p">,</span><span class="w"> </span><span class="m">6.61</span><span class="p">,</span>
<span class="w">        </span><span class="m">6.79</span><span class="p">,</span><span class="w"> </span><span class="m">6.94</span><span class="p">,</span><span class="w"> </span><span class="m">7.07</span><span class="p">,</span><span class="w"> </span><span class="m">7.19</span><span class="p">,</span><span class="w"> </span><span class="m">7.30</span><span class="p">)</span><span class="w">   </span><span class="c1"># yield curve</span>
<span class="bp">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">yield</span><span class="p">)</span><span class="w">                       </span><span class="c1"># number of time periods</span>
<span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.07</span><span class="w">                                </span><span class="c1"># initial yield rate</span>
<span class="n">Par</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="w">                                </span><span class="c1"># par value</span>
<span class="n">coupon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Par</span><span class="w">                        </span><span class="c1"># coupon payments</span>
<span class="n">cc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">coupon</span><span class="p">,</span><span class="w"> </span><span class="bp">T</span><span class="p">)</span><span class="w">                     </span><span class="c1"># vector of cash flows</span>
<span class="n">cc</span><span class="p">[</span><span class="bp">T</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cc</span><span class="p">[</span><span class="bp">T</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Par</span><span class="w">                     </span><span class="c1"># add par to cash flows</span>
<span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">cc</span><span class="o">/</span><span class="p">((</span><span class="m">1</span><span class="o">+</span><span class="n">yield</span><span class="o">/</span><span class="m">100</span><span class="p">)</span><span class="o">^</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="bp">T</span><span class="p">)))</span><span class="w">      </span><span class="c1"># calculate price</span>

<span class="nf">print</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 9.913206
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate yields in R</span>
<span class="c1"># Listing 7.7</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">12</span><span class="p">)</span><span class="w">                           </span><span class="c1"># set seed</span>

<span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="w">                            </span><span class="c1"># daily yield volatiltiy</span>
<span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="w">                                  </span><span class="c1"># number of simulations</span>
<span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">)</span><span class="w">                 </span><span class="c1"># generate random numbers </span>
<span class="n">ysim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">yield</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="n">ysim</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">yield</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="nf">matplot</span><span class="p">(</span><span class="n">ysim</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0013e25201da2f32be7d221f56d69bf0045fcc941ef99013bda19eab77162a5d.png" src="../_images/0013e25201da2f32be7d221f56d69bf0045fcc941ef99013bda19eab77162a5d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate bond prices in R</span>
<span class="c1"># Listing 7.9</span>
<span class="c1"># Last updated November 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">SP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">S</span><span class="p">){</span><span class="w">                            </span><span class="c1"># S simulations</span>
<span class="w">  </span><span class="n">SP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">cc</span><span class="o">/</span><span class="p">((</span><span class="m">1</span><span class="o">+</span><span class="n">ysim</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="m">100</span><span class="p">)</span><span class="o">^</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="bp">T</span><span class="p">)))</span>
<span class="p">}</span>
<span class="n">SP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SP</span><span class="o">-</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w">                     </span><span class="c1"># correct for mean</span>

<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">pty</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">)</span>

<span class="nf">barplot</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>

<span class="nf">hist</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span><span class="n">probability</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="nf">seq</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">16</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">SP</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="n">SP</span><span class="p">)))</span>


<span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50000</span>
<span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">)</span><span class="w">                 </span><span class="c1"># generate random numbers </span>
<span class="n">ysim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">yield</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="n">ysim</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">yield</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">SP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">S</span><span class="p">){</span><span class="w">                            </span><span class="c1"># S simulations</span>
<span class="w">  </span><span class="n">SP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">cc</span><span class="o">/</span><span class="p">((</span><span class="m">1</span><span class="o">+</span><span class="n">ysim</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="m">100</span><span class="p">)</span><span class="o">^</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="bp">T</span><span class="p">)))</span>
<span class="p">}</span>
<span class="n">SP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SP</span><span class="o">-</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w">                     </span><span class="c1"># correct for mean</span>

<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">pty</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">)</span>

<span class="nf">barplot</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>

<span class="nf">hist</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span><span class="n">probability</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="nf">seq</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">16</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">SP</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="n">SP</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ca8eee77ee25d9652bfac899109a948a60eb0b9ea968ad769ce683bfcef5d8fd.png" src="../_images/ca8eee77ee25d9652bfac899109a948a60eb0b9ea968ad769ce683bfcef5d8fd.png" />
<img alt="../_images/c936ea0e1d1ba748fe4eb8896d2c40a50c3fa1659f52cc2502579a83029abb2a.png" src="../_images/c936ea0e1d1ba748fe4eb8896d2c40a50c3fa1659f52cc2502579a83029abb2a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Black-Scholes valuation in R</span>
<span class="c1"># Listing 7.11</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="w">                          </span><span class="c1"># initial spot price</span>
<span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="w">                      </span><span class="c1"># annual volatility</span>
<span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="w">                         </span><span class="c1"># annual interest</span>
<span class="n">TT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="w">                         </span><span class="c1"># time to expiration</span>
<span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="w">                           </span><span class="c1"># strike price</span>
<span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="bp">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TT</span><span class="p">)</span><span class="w">          </span><span class="c1"># analytical call price</span>
<span class="c1">## This calculation uses the Black-Scholes pricing function (Listing 6.1/6.2)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>$Call
[1] 11.08728

$Put
[1] 0.09967718

$Delta.Call
[1] 0.9660259

$Delta.Put
[1] -0.03397407

$Gamma
[1] 0.01066378
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Black-Scholes simulation in R</span>
<span class="c1"># Listing 7.13</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">12</span><span class="p">)</span><span class="w">                                   </span><span class="c1"># set seed</span>

<span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1e6</span><span class="w">                                        </span><span class="c1"># number of simulations</span>
<span class="bp">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P0</span><span class="o">*</span><span class="nf">exp</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">TT</span><span class="p">)</span><span class="w">                               </span><span class="c1"># futures price</span>
<span class="n">ysim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="m">-0.5</span><span class="o">*</span><span class="n">sigma</span><span class="o">^</span><span class="m">2</span><span class="o">*</span><span class="n">TT</span><span class="p">,</span><span class="n">sigma</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">TT</span><span class="p">))</span><span class="w"> </span><span class="c1"># sim returns, lognorm corrected</span>
<span class="bp">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">F</span><span class="o">*</span><span class="nf">exp</span><span class="p">(</span><span class="n">ysim</span><span class="p">)</span><span class="w">                                </span><span class="c1"># sim futures price</span>
<span class="n">SP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">F</span><span class="o">-</span><span class="n">X</span><span class="w">                                       </span><span class="c1"># payoff</span>
<span class="n">SP</span><span class="p">[</span><span class="n">SP</span><span class="o">&lt;</span><span class="m">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w">                                   </span><span class="c1"># set negative outcomes to zero</span>
<span class="n">fsim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SP</span><span class="o">*</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">TT</span><span class="p">)</span><span class="w">                           </span><span class="c1"># discount</span>
<span class="n">call_sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">fsim</span><span class="p">)</span><span class="w">                          </span><span class="c1"># simulated price</span>

<span class="nf">print</span><span class="p">(</span><span class="n">call_sim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 11.08709
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option density plots in R</span>
<span class="c1"># Listing 7.15</span>
<span class="c1"># Last updated 2011</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">pty</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">)</span>

<span class="nf">hist</span><span class="p">(</span><span class="bp">F</span><span class="p">,</span><span class="w"> </span><span class="n">probability</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0.06</span><span class="p">))</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="bp">F</span><span class="p">),</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="bp">F</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="bp">F</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="n">SP</span><span class="p">)))</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">fsim</span><span class="p">,</span><span class="w"> </span><span class="n">nclass</span><span class="o">=</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">probability</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ee8ee1ae64f1d6215500a0ef4f4931323aeb021e926097373cef9a5d9028cc8a.png" src="../_images/ee8ee1ae64f1d6215500a0ef4f4931323aeb021e926097373cef9a5d9028cc8a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate VaR in R</span>
<span class="c1"># Listing 7.17</span>
<span class="c1"># Last updated 2011</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">                            </span><span class="c1"># set seed</span>

<span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1e7</span><span class="w">                                </span><span class="c1"># number of simulations</span>
<span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="o">^</span><span class="m">2</span><span class="w">                            </span><span class="c1"># daily variance</span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="w">                               </span><span class="c1"># probability</span>
<span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="w">                               </span><span class="c1"># annual riskfree rate</span>
<span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="w">                                </span><span class="c1"># price today</span>
<span class="n">ysim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">r</span><span class="o">/</span><span class="m">365-0.5</span><span class="o">*</span><span class="n">s2</span><span class="p">,</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span><span class="w">  </span><span class="c1"># sim returns</span>
<span class="n">Psim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="o">*</span><span class="nf">exp</span><span class="p">(</span><span class="n">ysim</span><span class="p">)</span><span class="w">                     </span><span class="c1"># sim future prices</span>
<span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">Psim</span><span class="o">-</span><span class="n">P</span><span class="p">)</span><span class="w">                       </span><span class="c1"># simulated P/L</span>
<span class="n">VaR1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="n">S</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="n">VaR1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 2.289809
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate option VaR in R</span>
<span class="c1"># Listing 7.19</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">TT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="w">                                         </span><span class="c1"># time to expiration</span>
<span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="w">                                           </span><span class="c1"># strike price</span>
<span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s2</span><span class="o">*</span><span class="m">250</span><span class="p">)</span><span class="w">                              </span><span class="c1"># annual volatility</span>
<span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">TT</span><span class="p">)</span><span class="w">                        </span><span class="c1"># analytical call price</span>
<span class="n">fsim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Psim</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">TT</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">365</span><span class="p">))</span><span class="w">              </span><span class="c1"># sim option prices </span>
<span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">fsim</span><span class="o">$</span><span class="n">Call</span><span class="o">-</span><span class="n">f</span><span class="o">$</span><span class="n">Call</span><span class="p">)</span><span class="w">                        </span><span class="c1"># simulated P/L</span>
<span class="n">VaR2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="n">S</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="n">VaR2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 1.214623
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example 7.3 in R</span>
<span class="c1"># Listing 7.21</span>
<span class="c1"># Last updated August 2016</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">X1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="w">                                 </span>
<span class="n">X2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">110</span><span class="w">                                 </span>
<span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">TT</span><span class="p">)</span><span class="w">                 </span>
<span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">TT</span><span class="p">)</span><span class="w">                 </span>
<span class="n">f2sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span><span class="w"> </span><span class="n">Psim</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">TT</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">365</span><span class="p">))</span>
<span class="n">f1sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span><span class="w"> </span><span class="n">Psim</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">TT</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">365</span><span class="p">))</span>
<span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">f1sim</span><span class="o">$</span><span class="n">Call</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f2sim</span><span class="o">$</span><span class="n">Put</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Psim</span><span class="o">-</span><span class="n">f1</span><span class="o">$</span><span class="n">Call</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f2</span><span class="o">$</span><span class="n">Put</span><span class="o">-</span><span class="n">P</span><span class="p">);</span><span class="w"> </span>
<span class="n">VaR3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="n">S</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="n">VaR3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 1.494695
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulated two-asset returns in R</span>
<span class="c1"># Listing 7.23</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">library </span><span class="p">(</span><span class="n">MASS</span><span class="p">)</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">12</span><span class="p">)</span><span class="w">  </span><span class="c1"># set seed</span>

<span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="m">365</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">                                    </span><span class="c1"># return mean</span>
<span class="n">Sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="m">0.0005</span><span class="p">,</span><span class="w"> </span><span class="m">0.0005</span><span class="p">,</span><span class="w"> </span><span class="m">0.02</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">  </span><span class="c1"># covariance matrix</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mvrnorm</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">Sigma</span><span class="p">)</span><span class="w">  </span><span class="c1"># simulated returns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Two-asset VaR in R</span>
<span class="c1"># Listing 7.25</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">K</span><span class="o">=</span><span class="m">2</span>
<span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">)</span><span class="w">                                 </span><span class="c1"># prices</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">                                  </span><span class="c1"># number of assets</span>
<span class="n">Port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">x</span><span class="w">                                 </span><span class="c1"># portfolio at t</span>
<span class="n">Psim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="nf">matrix</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="n">S</span><span class="p">)),</span><span class="n">ncol</span><span class="o">=</span><span class="n">K</span><span class="p">)</span><span class="o">*</span><span class="nf">exp</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">  </span><span class="c1"># simulated prices</span>
<span class="n">PortSim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Psim</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">x</span><span class="w">                           </span><span class="c1"># simulated portfolio value</span>
<span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">PortSim</span><span class="o">-</span><span class="n">Port</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">])</span><span class="w">                    </span><span class="c1"># simulated P/L</span>
<span class="n">VaR4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">S</span><span class="o">*</span><span class="n">p</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="n">VaR4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 25.96307
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># A two-asset case in R with an option</span>
<span class="c1"># Listing 7.27</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="bp">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TT</span><span class="p">)</span>
<span class="n">fsim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Psim</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="bp">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TT</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">365</span><span class="p">))</span>
<span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">fsim</span><span class="o">$</span><span class="n">Call</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Psim</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f</span><span class="o">$</span><span class="n">Call</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">P</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span><span class="w"> </span>
<span class="n">VaR5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="n">S</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="n">VaR5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 20.79232
</pre></div>
</div>
</div>
</div>
<p><a id='8'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-8-backtesting-and-stress-testing">
<h1>Chapter 8: Backtesting and Stress Testing<a class="headerlink" href="#chapter-8-backtesting-and-stress-testing" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>8.1: Loading hypothetical stock prices, converting to returns</p></li>
<li><p>8.3: Setting up backtest</p></li>
<li><p>8.5: Running backtest for EWMA/MA/HS/GARCH VaR</p></li>
<li><p>8.7: Backtesting analysis for EWMA/MA/HS/GARCH VaR</p></li>
<li><p>8.9: Bernoulli coverage test</p></li>
<li><p>8.11: Independence test</p></li>
<li><p>8.13: Running Bernoulli/Independence test on backtests</p></li>
<li><p>8.15: Running backtest for EWMA/HS ES</p></li>
<li><p>8.17: Backtesting analysis for EWMA/HS ES</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data in R</span>
<span class="c1"># Listing 8.1</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>


<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&#39;index.csv&#39;</span><span class="p">)</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">diff</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">p</span><span class="o">$</span><span class="n">Index</span><span class="p">))</span><span class="w"> </span><span class="c1"># get returns </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set backtest up in R</span>
<span class="c1"># Listing 8.3</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">WE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="w">                             </span><span class="c1"># estimation window length</span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="w">                              </span><span class="c1"># probability</span>
<span class="n">l1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ceiling</span><span class="p">(</span><span class="n">WE</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="w">                    </span><span class="c1"># HS quantile</span>
<span class="n">portfolio_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">                   </span><span class="c1"># portfolio value</span>
<span class="n">VaR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">   </span><span class="c1"># matrix for forecasts</span>

<span class="c1">## EWMA setup</span>
<span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.94</span><span class="w">       </span>
<span class="n">s11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nf">for</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="n">WE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">s11</span><span class="o">=</span><span class="n">lambda</span><span class="o">*</span><span class="n">s11</span><span class="o">+</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">lambda</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="m">-1</span><span class="p">]</span><span class="o">^</span><span class="m">2</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Running backtest in R</span>
<span class="c1"># Listing 8.5</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">## this will take several minutes to run</span>

<span class="nf">library</span><span class="p">(</span><span class="n">rugarch</span><span class="p">)</span>
<span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchspec</span><span class="p">(</span><span class="n">variance.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">garchOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span>
<span class="w">                  </span><span class="n">mean.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w"> </span><span class="n">armaOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="n">include.mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span>
<span class="n">start_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">for </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="nf">in </span><span class="p">(</span><span class="n">WE</span><span class="m">+1</span><span class="p">)</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)){</span>
<span class="w">  </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-</span><span class="n">WE</span><span class="p">;</span><span class="w">         </span><span class="c1"># start of the data window</span>
<span class="w">  </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="m">-1</span><span class="p">;</span><span class="w">	         </span><span class="c1"># end of the data window</span>
<span class="w">  </span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">t1</span><span class="o">:</span><span class="n">t2</span><span class="p">]</span><span class="w">  </span><span class="c1"># data for estimation</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">s11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="o">*</span><span class="n">s11</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">lambda</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="m">-1</span><span class="p">]</span><span class="o">^</span><span class="m">2</span>
<span class="w">  </span><span class="n">VaR</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span><span class="w">          </span><span class="c1"># EWMA</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">VaR</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">portfolio_value</span><span class="w">          </span><span class="c1"># MA</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="w">                              </span>
<span class="w">  </span><span class="n">VaR</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ys</span><span class="p">[</span><span class="n">l1</span><span class="p">]</span><span class="o">*</span><span class="n">portfolio_value</span><span class="w">                          </span><span class="c1"># HS</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ugarchfit</span><span class="p">(</span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">,</span><span class="n">solver</span><span class="o">=</span><span class="s">&quot;hybrid&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="n">omega</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">@</span><span class="n">fit</span><span class="o">$</span><span class="n">coef</span><span class="p">[</span><span class="s">&#39;omega&#39;</span><span class="p">]</span>
<span class="w">  </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">@</span><span class="n">fit</span><span class="o">$</span><span class="n">coef</span><span class="p">[</span><span class="s">&#39;alpha1&#39;</span><span class="p">]</span>
<span class="w">  </span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">@</span><span class="n">fit</span><span class="o">$</span><span class="n">coef</span><span class="p">[</span><span class="s">&#39;beta1&#39;</span><span class="p">]</span>
<span class="w">  </span><span class="n">sigma2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">omega</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">tail</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">tail</span><span class="p">(</span><span class="n">res</span><span class="o">@</span><span class="n">fit</span><span class="o">$</span><span class="n">var</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">  </span>
<span class="w">  </span><span class="n">VaR</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="m">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">sigma2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span><span class="w">       </span><span class="c1"># GARCH(1,1)</span>
<span class="p">}</span>
<span class="n">end_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Sys.time</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time difference of 5.200304 mins
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backtesting analysis in R</span>
<span class="c1"># Listing 8.7</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">){</span>
<span class="w">  </span><span class="n">VR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[(</span><span class="n">WE</span><span class="m">+1</span><span class="p">)</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="n">VaR</span><span class="p">[(</span><span class="n">WE</span><span class="m">+1</span><span class="p">)</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">WE</span><span class="p">))</span>
<span class="w">  </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="n">VaR</span><span class="p">[(</span><span class="n">WE</span><span class="m">+1</span><span class="p">)</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">i</span><span class="p">])</span>
<span class="w">  </span><span class="nf">cat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&quot;VR&quot;</span><span class="p">,</span><span class="n">VR</span><span class="p">,</span><span class="s">&quot;VaR vol&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">matplot</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">VaR</span><span class="p">),</span><span class="n">type</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="n">las</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>
<span class="nf">legend</span><span class="p">(</span><span class="s">&quot;topleft&quot;</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Returns&quot;</span><span class="p">,</span><span class="s">&quot;EWMA&quot;</span><span class="p">,</span><span class="s">&quot;MA&quot;</span><span class="p">,</span><span class="s">&quot;HS&quot;</span><span class="p">,</span><span class="s">&quot;GARCH&quot;</span><span class="p">),</span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="n">bty</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 VR 2.074423 VaR vol 0.01211406 
2 VR 1.860565 VaR vol 0.006622265 
3 VR 1.240376 VaR vol 0.01229172 
4 VR 1.73225 VaR vol 0.01146659 
</pre></div>
</div>
<img alt="../_images/cdbaf8f26963b7cdfdbc568d313d96f7a921e7a7f2802bdcdaa5de8cddb35159.png" src="../_images/cdbaf8f26963b7cdfdbc568d313d96f7a921e7a7f2802bdcdaa5de8cddb35159.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bernoulli coverage test in R</span>
<span class="c1"># Listing 8.9</span>
<span class="c1"># Last updated August 2016</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">bern_test</span><span class="o">=</span><span class="nf">function</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">){</span>
<span class="w">  </span><span class="n">lv</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="w">  </span><span class="n">sv</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">al</span><span class="o">=</span><span class="nf">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">sv</span><span class="o">+</span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">lv</span><span class="o">-</span><span class="n">sv</span><span class="p">)</span>
<span class="w">  </span><span class="n">bl</span><span class="o">=</span><span class="nf">log</span><span class="p">(</span><span class="n">sv</span><span class="o">/</span><span class="n">lv</span><span class="p">)</span><span class="o">*</span><span class="n">sv</span><span class="w"> </span><span class="o">+</span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">sv</span><span class="o">/</span><span class="n">lv</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">lv</span><span class="o">-</span><span class="n">sv</span><span class="p">)</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="m">-2</span><span class="o">*</span><span class="p">(</span><span class="n">al</span><span class="o">-</span><span class="n">bl</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Independence test in R</span>
<span class="c1"># Listing 8.11</span>
<span class="c1"># Last updated June 2018</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">ind_test</span><span class="o">=</span><span class="nf">function</span><span class="p">(</span><span class="n">V</span><span class="p">){</span>
<span class="w">  </span><span class="n">J</span><span class="o">=</span><span class="nf">matrix</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">V</span><span class="p">))</span>
<span class="w">  </span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">V</span><span class="p">)){</span>
<span class="w">    </span><span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="o">=</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">]</span><span class="o">==</span><span class="m">0</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="m">0</span>
<span class="w">    </span><span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="o">=</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">]</span><span class="o">==</span><span class="m">0</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="m">1</span>
<span class="w">    </span><span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">3</span><span class="p">]</span><span class="o">=</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">]</span><span class="o">==</span><span class="m">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="m">0</span>
<span class="w">    </span><span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">4</span><span class="p">]</span><span class="o">=</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">]</span><span class="o">==</span><span class="m">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="m">1</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">V_00</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">J</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">  </span><span class="n">V_01</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">J</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">  </span><span class="n">V_10</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">J</span><span class="p">[,</span><span class="m">3</span><span class="p">],</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">  </span><span class="n">V_11</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">J</span><span class="p">[,</span><span class="m">4</span><span class="p">],</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">  </span><span class="n">p_00</span><span class="o">=</span><span class="n">V_00</span><span class="o">/</span><span class="p">(</span><span class="n">V_00</span><span class="o">+</span><span class="n">V_01</span><span class="p">)</span>
<span class="w">  </span><span class="n">p_01</span><span class="o">=</span><span class="n">V_01</span><span class="o">/</span><span class="p">(</span><span class="n">V_00</span><span class="o">+</span><span class="n">V_01</span><span class="p">)</span>
<span class="w">  </span><span class="n">p_10</span><span class="o">=</span><span class="n">V_10</span><span class="o">/</span><span class="p">(</span><span class="n">V_10</span><span class="o">+</span><span class="n">V_11</span><span class="p">)</span>
<span class="w">  </span><span class="n">p_11</span><span class="o">=</span><span class="n">V_11</span><span class="o">/</span><span class="p">(</span><span class="n">V_10</span><span class="o">+</span><span class="n">V_11</span><span class="p">)</span>
<span class="w">  </span><span class="n">hat_p</span><span class="o">=</span><span class="p">(</span><span class="n">V_01</span><span class="o">+</span><span class="n">V_11</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">V_00</span><span class="o">+</span><span class="n">V_01</span><span class="o">+</span><span class="n">V_10</span><span class="o">+</span><span class="n">V_11</span><span class="p">)</span>
<span class="w">  </span><span class="n">al</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">hat_p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">V_00</span><span class="o">+</span><span class="n">V_10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">hat_p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">V_01</span><span class="o">+</span><span class="n">V_11</span><span class="p">)</span>
<span class="w">  </span><span class="n">bl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">p_00</span><span class="p">)</span><span class="o">*</span><span class="n">V_00</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">p_01</span><span class="p">)</span><span class="o">*</span><span class="n">V_01</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">p_10</span><span class="p">)</span><span class="o">*</span><span class="n">V_10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">p_11</span><span class="p">)</span><span class="o">*</span><span class="n">V_11</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="m">-2</span><span class="o">*</span><span class="p">(</span><span class="n">al</span><span class="o">-</span><span class="n">bl</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backtesting S&amp;P 500 in R</span>
<span class="c1"># Listing 8.13</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">W1</span><span class="o">=</span><span class="n">WE</span><span class="m">+1</span>
<span class="n">ya</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">W1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span>
<span class="n">VaRa</span><span class="o">=</span><span class="n">VaR</span><span class="p">[</span><span class="n">W1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">),]</span>
<span class="n">m</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;EWMA&quot;</span><span class="p">,</span><span class="s">&quot;MA&quot;</span><span class="p">,</span><span class="s">&quot;HS&quot;</span><span class="p">,</span><span class="s">&quot;GARCH&quot;</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">){</span>
<span class="w">  </span><span class="n">q</span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">W1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="n">VaR</span><span class="p">[</span><span class="n">W1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">i</span><span class="p">]</span>
<span class="w">  </span><span class="n">v</span><span class="o">=</span><span class="n">VaRa</span><span class="o">*</span><span class="m">0</span>
<span class="w">  </span><span class="n">v</span><span class="p">[</span><span class="n">q</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="m">1</span>
<span class="w">  </span><span class="n">ber</span><span class="o">=</span><span class="nf">bern_test</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">[,</span><span class="n">i</span><span class="p">])</span>
<span class="w">  </span><span class="n">ind</span><span class="o">=</span><span class="nf">ind_test</span><span class="p">(</span><span class="n">v</span><span class="p">[,</span><span class="n">i</span><span class="p">])</span>
<span class="w">  </span><span class="nf">cat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;Bernoulli - &quot;</span><span class="p">,</span><span class="s">&quot;Test statistic:&quot;</span><span class="p">,</span><span class="n">ber</span><span class="p">,</span><span class="s">&quot;  p-value:&quot;</span><span class="p">,</span><span class="m">1</span><span class="o">-</span><span class="nf">pchisq</span><span class="p">(</span><span class="n">ber</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="s">&quot;\n&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;Independence - &quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test statistic:&quot;</span><span class="p">,</span><span class="n">ind</span><span class="p">,</span><span class="s">&quot;  p-value:&quot;</span><span class="p">,</span><span class="m">1</span><span class="o">-</span><span class="nf">pchisq</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="s">&quot;\n \n&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 EWMA 
 Bernoulli -  Test statistic: 41.6257   p-value: 1.105309e-10 
 Independence -  Test statistic: 0.4411056   p-value: 0.5065893 
 
2 MA 
 Bernoulli -  Test statistic: 27.90392   p-value: 1.27491e-07 
 Independence -  Test statistic: 17.44182   p-value: 2.962367e-05 
 
3 HS 
 Bernoulli -  Test statistic: 2.535439   p-value: 0.1113159 
 Independence -  Test statistic: 11.48482   p-value: 0.0007016709 
 
4 GARCH 
 Bernoulli -  Test statistic: 20.78009   p-value: 5.151585e-06 
 Independence -  Test statistic: 0.2328221   p-value: 0.6294391 
 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backtest ES in R</span>
<span class="c1"># Listing 8.15</span>
<span class="c1"># Last updated July 2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">VaR2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">                    </span><span class="c1"># VaR forecasts for 2 models</span>
<span class="n">ES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">                      </span><span class="c1"># ES forecasts for 2 models</span>

<span class="nf">for </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="nf">in </span><span class="p">(</span><span class="n">WE</span><span class="m">+1</span><span class="p">)</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)){</span>
<span class="w">  </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">-</span><span class="n">WE</span><span class="p">;</span>
<span class="w">  </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="m">-1</span><span class="p">;</span>
<span class="w">  </span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">t1</span><span class="o">:</span><span class="n">t2</span><span class="p">]</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">s11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">s11</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">lambda</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="m">-1</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="w"> </span>
<span class="w">  </span><span class="n">VaR2</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span><span class="w">    </span><span class="c1"># EWMA</span>
<span class="w">  </span><span class="n">ES</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">p</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="w">  </span><span class="n">VaR2</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ys</span><span class="p">[</span><span class="n">l1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span><span class="w">                  </span><span class="c1"># HS</span>
<span class="w">  </span><span class="n">ES</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">l1</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portfolio_value</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backtest ES in R</span>
<span class="c1"># Listing 8.17</span>
<span class="c1"># Last updated August 2019</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">ESa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ES</span><span class="p">[</span><span class="n">W1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">),]</span>
<span class="n">VaRa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VaR2</span><span class="p">[</span><span class="n">W1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">),]</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">){</span>
<span class="w">  </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="o">-</span><span class="n">VaRa</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span>
<span class="w">  </span><span class="n">nES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">ya</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="o">-</span><span class="n">ESa</span><span class="p">[</span><span class="n">q</span><span class="p">,</span><span class="n">i</span><span class="p">])</span>
<span class="w">  </span><span class="nf">cat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&quot;nES&quot;</span><span class="p">,</span><span class="n">nES</span><span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 nES 1.223518 
2 nES 1.053689 
</pre></div>
</div>
</div>
</div>
<p><a id='9'></a></p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="chapter-9-extreme-value-theory">
<h1>Chapter 9: Extreme Value Theory<a class="headerlink" href="#chapter-9-extreme-value-theory" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>9.1: Calculation of tail index from returns</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Hill estimator in R</span>
<span class="c1"># Listing 9.1</span>
<span class="c1"># Last updated 2011</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="n">ysort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">                             </span><span class="c1"># sort the returns</span>
<span class="n">CT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="w">                                    </span><span class="c1"># set the threshold</span>
<span class="n">iota</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="nf">mean</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">ysort</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">CT</span><span class="p">]</span><span class="o">/</span><span class="n">ysort</span><span class="p">[</span><span class="n">CT</span><span class="m">+1</span><span class="p">]))</span><span class="w"> </span><span class="c1"># get the tail index</span>

<span class="nf">print</span><span class="p">(</span><span class="n">iota</span><span class="p">)</span>

<span class="c1"># END</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 2.62971
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./Risk"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Introduction</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix-an-introduction-to-r">Appendix: An Introduction to R</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-1-financial-markets-prices-and-risk">Chapter 1: Financial Markets, Prices and Risk</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-2-univariate-volatility-modelling">Chapter 2: Univariate Volatility Modelling</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-3-multivariate-volatility-models">Chapter 3: Multivariate Volatility Models</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-4-risk-measures">Chapter 4: Risk Measures</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-5-implementing-risk-forecasts">Chapter 5: Implementing Risk Forecasts</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-6-analytical-value-at-risk-for-options-and-bonds">Chapter 6: Analytical Value-at-Risk for Options and Bonds</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-7-simulation-methods-for-var-for-options-and-bonds">Chapter 7: Simulation Methods for VaR for Options and Bonds</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-8-backtesting-and-stress-testing">Chapter 8: Backtesting and Stress Testing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-9-extreme-value-theory">Chapter 9: Extreme Value Theory</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FinX Lab
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>